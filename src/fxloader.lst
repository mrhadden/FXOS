  Sat Jul 10 2021  1:15                                                                                                Page 1

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

                                             ***************************************
                                             **      WDC 65C816 Macro Assembler   **
                                             **                                   **
                                             **     Version 3.49.1- Feb  6 2006    **
                                             ***************************************

     1                        ; File: WDC_CStartup_816.asm
     2                        ; 05/14/2004
     3                        
     4                             PW 128         ;Page Width (# of char/line) 
     5                             PL 60          ;Page Length for HP Laser
     6                             INCLIST ON     ;Add Include files in Listing
     7                        
     8                        				;*********************************************
     9                        				;Test for Valid Processor defined in -D option
    10                        				;*********************************************
    11                        	IF	USING_265
    12                        	ELSEIF	USING_816
    13                        	ELSEIF	USING_CDC16F 
    14                        	ELSE
    15                        		EXIT         "Not Valid Processor: Use -DUSING_816, etc. ! ! ! ! ! ! ! ! ! ! ! !"
    16                        	ENDIF
    17                        
    18                        
    19                        				;*********************************************
    20                        				;Test for Valid 'Model' type defined in -D option
    21                        				;*********************************************
    22                        	IF	SMALL
    23                        	ELSEIF	MEDIUM
    24                        	ELSEIF	COMPACT
    25                        	ELSEIF	LARGE
    26                        	ELSE
    27                        ;		EXIT         "Not Valid 'Model' type - SMALL, MEDIUM, COMPACT, or LARGE: Use -DSMALL, et
                    c. ! ! ! ! ! ! ! ! ! ! ! !"
    28                        	ENDIF
    29                        
    30                        	title  "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    31                        
    32                        	INCLUDE interrupt_def.asm
     1                        ; Pending Interrupt (Read and Write Back to Clear)
     2             00000140   INT_PENDING_REG0 EQU $000140 ;
     3             00000141   INT_PENDING_REG1 EQU $000141 ;
     4             00000142   INT_PENDING_REG2 EQU $000142 ;
     5             00000143   INT_PENDING_REG3 EQU $000143 ; FMX Model
     6                        ; Polarity Set
     7             00000144   INT_POL_REG0     EQU $000144 ;
     8             00000145   INT_POL_REG1     EQU $000145 ;
     9             00000146   INT_POL_REG2     EQU $000146 ;
    10             00000147   INT_POL_REG7     EQU $000147 ; FMX Model
    11                        ; Edge Detection Enable
    12             00000148   INT_EDGE_REG0    EQU $000148 ;
    13             00000149   INT_EDGE_REG1    EQU $000149 ;
    14             0000014A   INT_EDGE_REG2    EQU $00014A ;
    15             0000014B   INT_EDGE_REG3    EQU $00014B ; FMX Model
    16                        ; Mask
  Sat Jul 10 2021  1:15                                                                                                Page 2

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    17             0000014C   INT_MASK_REG0    EQU $00014C ;
    18             0000014D   INT_MASK_REG1    EQU $00014D ;
    19             0000014E   INT_MASK_REG2    EQU $00014E ;
    20             0000014F   INT_MASK_REG3    EQU $00014F ; FMX Model
    21                        ; Interrupt Bit Definition
    22                        ; Register Block 0
    23             00000001   FNX0_INT00_SOF        EQU $01  ;Start of Frame @ 60FPS
    24             00000002   FNX0_INT01_SOL        EQU $02  ;Start of Line (Programmable)
    25             00000004   FNX0_INT02_TMR0       EQU $04  ;Timer 0 Interrupt
    26             00000008   FNX0_INT03_TMR1       EQU $08  ;Timer 1 Interrupt
    27             00000010   FNX0_INT04_TMR2       EQU $10  ;Timer 2 Interrupt
    28             00000020   FNX0_INT05_RTC        EQU $20  ;Real-Time Clock Interrupt
    29             00000040   FNX0_INT06_FDC        EQU $40  ;Floppy Disk Controller
    30             00000080   FNX0_INT07_MOUSE      EQU $80  ; Mouse Interrupt (INT12 in SuperIO IOspace)
    31                        ; Register Block 1
    32             00000001   FNX1_INT00_KBD        EQU $01  ;Keyboard Interrupt
    33             00000002   FNX1_INT01_COL0       EQU $02  ;VICKY_II (INT2) Sprite Collision
    34             00000004   FNX1_INT02_COL1       EQU $04  ;VICKY_II (INT3) Bitmap Collision
    35             00000008   FNX1_INT03_COM2       EQU $08  ;Serial Port 2
    36             00000010   FNX1_INT04_COM1       EQU $10  ;Serial Port 1
    37             00000020   FNX1_INT05_MPU401     EQU $20  ;Midi Controller Interrupt
    38             00000040   FNX1_INT06_LPT        EQU $40  ;Parallel Port
    39             00000080   FNX1_INT07_SDCARD     EQU $80  ;SD Card Controller Interrupt (CH376S)
    40                        ; Register Block 2
    41             00000001   FNX2_INT00_OPL3       EQU $01  ;OPl3
    42             00000002   FNX2_INT01_GABE_INT0  EQU $02  ;GABE (INT0) - TBD
    43             00000004   FNX2_INT02_GABE_INT1  EQU $04  ;GABE (INT1) - TBD
    44             00000008   FNX2_INT03_VDMA       EQU $08  ;VICKY_II (INT4) - VDMA Interrupt
    45             00000010   FNX2_INT04_COL2       EQU $10  ;VICKY_II (INT5) Tile Collision
    46             00000020   FNX2_INT05_GABE_INT2  EQU $20  ;GABE (INT2) - TBD
    47             00000040   FNX2_INT06_EXT        EQU $40  ;External Expansion
    48             00000080   FNX2_INT07_SDCARD_INS EQU $80  ; SDCARD Insertion
    49                        ; Register Block 3 (FMX Expansion)
    50             00000001   FNX3_INT00_OPN2       EQU $01  ;OPN2
    51             00000002   FNX3_INT01_OPM        EQU $02  ;OPM
    52             00000004   FNX3_INT02_IDE        EQU $04  ;HDD IDE INTERRUPT
    53             00000008   FNX3_INT03_TBD        EQU $08  ;TBD
    54             00000010   FNX3_INT04_TBD        EQU $10  ;TBD
    55             00000020   FNX3_INT05_TBD        EQU $20  ;GABE (INT2) - TBD
    56             00000040   FNX3_INT06_TBD        EQU $40  ;External Expansion
    57             00000080   FNX3_INT07_TBD        EQU $80  ; SDCARD Insertion
    33                        	INCLUDE macros_inc.asm
     1                        ; Set 8-bit accumulator
     2                        setaxs          .macro
     3                                        SEP #$30        ; set A&X short
     4                                        LONGA OFF
     5                                        LONGI OFF 
     6                                        .endm
     7                                        
     8                        ; Set 16-bit accumulator
     9                        setaxl          .macro
    10                                        REP #$30        ; set A&X long 
    11                                        LONGA ON
    12                                        LONGI ON
    13                                        .endm
  Sat Jul 10 2021  1:15                                                                                                Page 3

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    14                        
    15                        ; Set 8-bit accumulator
    16                        setas           .macro
    17                                        SEP #$20        ; set A short 
    18                                        LONGA OFF
    19                                        .endm
    20                                        
    21                        ; Set 16-bit accumulator
    22                        setal           .macro
    23                                        REP #$20        ; set A long 
    24                                        LONGA ON
    25                                        .endm
    26                        
    27                        ; Set 8 bit index registers               
    28                        setxs           .macro
    29                                        SEP #$10        ; set X short 
    30                                        LONGI OFF
    31                                        .endm
    32                                        
    33                        ; Set 16-bit index registers
    34                        setxl           .macro
    35                                        REP #$10        ; set X long 
    36                                        LONGI ON
    37                                        .endm
    38                        
    39                        ; Set the direct page. 
    40                        ; Note: This uses the accumulator and leaves A set to 16 bits. 
    41                        setdp           .macro                
    42                                        PHA             ; begin setdp macro 
    43                        	PHP
    44                                        setal
    45                                        LDA #\1         ; set DP to page 0
    46                                        TCD             
    47                                        .dpage \1
    48                        	PLP
    49                                        PLA             ; end setdp macro 
    50                                        .endm 
    51                        
    52                        setdbr          .macro          ; Set the B (Data bank) register 
    53                                        PHA             ; begin setdbr macro 
    54                                        PHP
    55                                        setas
    56                        	LDA #\1         
    57                                        PHA
    58                                        PLB
    59                                        .databank \1
    60                                        PLP
    61                                        PLA             ; end setdbr macro 
    62                                        .endm 
    63                        
    34                        	INCLUDE super_io_def.asm
     1                        ;Super IO Registers
     2             00AF1100   PME_STS_REG      EQU  $AF1100
     3             00AF1102   PME_EN_REG		   EQU  $AF1102
     4             00AF1104   PME_STS1_REG		 EQU  $AF1104
  Sat Jul 10 2021  1:15                                                                                                Page 4

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

     5             00AF1105   PME_STS2_REG		 EQU  $AF1105
     6             00AF1106   PME_STS3_REG		 EQU  $AF1106
     7             00AF1107   PME_STS4_REG		 EQU  $AF1107
     8             00AF1108   PME_STS5_REG		 EQU  $AF1108
     9             00AF110A   PME_EN1_REG      EQU  $AF110A
    10             00AF110B   PME_EN2_REG      EQU  $AF110B
    11             00AF110C   PME_EN3_REG      EQU  $AF110C
    12             00AF110D   PME_EN4_REG      EQU  $AF110D
    13             00AF110E   PME_EN5_REG      EQU  $AF110E
    14             00AF1110   SMI_STS1_REG		 EQU  $AF1110
    15             00AF1111   SMI_STS2_REG		 EQU  $AF1111
    16             00AF1112   SMI_STS3_REG		 EQU  $AF1112
    17             00AF1113   SMI_STS4_REG		 EQU  $AF1113
    18             00AF1114   SMI_STS5_REG		 EQU  $AF1114
    19             00AF1116   SMI_EN1_REG      EQU  $AF1116
    20             00AF1117   SMI_EN2_REG      EQU  $AF1117
    21             00AF1118   SMI_EN3_REG      EQU  $AF1118
    22             00AF1119   SMI_EN4_REG      EQU  $AF1119
    23             00AF111A   SMI_EN5_REG      EQU  $AF111A
    24             00AF111C   MSC_ST_REG       EQU  $AF111C
    25             00AF111E   FORCE_DISK_CHANGE        EQU  $AF111E
    26             00AF111F   FLOPPY_DATA_RATE         EQU  $AF111F
    27             00AF1120   UART1_FIFO_CTRL_SHDW     EQU  $AF1120
    28             00AF1121   UART2_FIFO_CTRL_SHDW     EQU  $AF1121
    29             00AF1122   DEV_DISABLE_REG          EQU  $AF1122
    30             00AF1123   GP10_REG    		 EQU  $AF1123
    31             00AF1124   GP11_REG    		 EQU  $AF1124
    32             00AF1125   GP12_REG    		 EQU  $AF1125
    33             00AF1126   GP13_REG    		 EQU  $AF1126
    34             00AF1127   GP14_REG    		 EQU  $AF1127
    35             00AF1128   GP15_REG    		 EQU  $AF1128
    36             00AF1129   GP16_REG    		 EQU  $AF1129
    37             00AF112A   GP17_REG    		 EQU  $AF112A
    38             00AF112B   GP20_REG    		 EQU  $AF112B
    39             00AF112C   GP21_REG    		 EQU  $AF112C
    40             00AF112D   GP22_REG		 EQU  $AF112D
    41             00AF112F   GP24_REG		 EQU  $AF112F
    42             00AF1130   GP25_REG		 EQU  $AF1130
    43             00AF1131   GP26_REG		 EQU  $AF1131
    44             00AF1132   GP27_REG		 EQU  $AF1132
    45             00AF1133   GP30_REG		 EQU  $AF1133
    46             00AF1134   GP31_REG		 EQU  $AF1134
    47             00AF1135   GP32_REG		 EQU  $AF1135
    48             00AF1136   GP33_REG		 EQU  $AF1136
    49             00AF1137   GP34_REG		 EQU  $AF1137
    50             00AF1138   GP35_REG		 EQU  $AF1138
    51             00AF1139   GP36_REG		 EQU  $AF1139
    52             00AF113A   GP37_REG		 EQU  $AF113A
    53             00AF113B   GP40_REG		 EQU  $AF113B
    54             00AF113C   GP41_REG		 EQU  $AF113C
    55             00AF113D   GP42_REG		 EQU  $AF113D
    56             00AF113E   GP43_REG		 EQU  $AF113E
    57             00AF113F   GP50_REG		 EQU  $AF113F
    58             00AF1140   GP51_REG		 EQU  $AF1140
    59             00AF1141   GP52_REG		 EQU  $AF1141
  Sat Jul 10 2021  1:15                                                                                                Page 5

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    60             00AF1142   GP53_REG		 EQU  $AF1142
    61             00AF1143   GP54_REG		 EQU  $AF1143
    62             00AF1144   GP55_REG		 EQU  $AF1144
    63             00AF1145   GP56_REG		 EQU  $AF1145
    64             00AF1146   GP57_REG		 EQU  $AF1146
    65             00AF1147   GP60_REG		 EQU  $AF1147
    66             00AF1148   GP61_REG		 EQU  $AF1148
    67             00AF114B   GP1_REG			 EQU  $AF114B
    68             00AF114C   GP2_REG			 EQU  $AF114C
    69             00AF114D   GP3_REG			 EQU  $AF114D
    70             00AF114E   GP4_REG			 EQU  $AF114E
    71             00AF114F   GP5_REG			 EQU  $AF114F
    72             00AF1150   GP6_REG			 EQU  $AF1150
    73             00AF1156   FAN1_REG		         EQU  $AF1156
    74             00AF1157   FAN2_REG             EQU  $AF1157
    75             00AF1158   FAN_CTRL_REG  	     EQU  $AF1158
    76             00AF1159   FAN1_TACH_REG        EQU  $AF1159
    77             00AF115A   FAN2_TACH_REG        EQU  $AF115A
    78             00AF115B   FAN1_PRELOAD_REG     EQU  $AF115B
    79             00AF115C   FAN2_PRELOAD_REG     EQU  $AF115C
    80             00AF115D   LED1_REG    		     EQU  $AF115D
    81             00AF115E   LED2_REG    		     EQU  $AF115E
    82             00AF115F   KEYBOARD_SCAN_CODE	 EQU  $AF115F
    35                        	INCLUDE vicky_def.asm
     1                        ;Internal VICKY Registers and Internal Memory Locations (LUTs)
     2             00AF0000   MASTER_CTRL_REG_L	       EQU  $AF0000
     3                        ;Control Bits Fields
     4             00000001   Mstr_Ctrl_Text_Mode_En   EQU  $01       ; Enable the Text Mode
     5             00000002   Mstr_Ctrl_Text_Overlay   EQU  $02       ; Enable the Overlay of the text mode on top of Graphic Mo
                    de (the Background Color is ignored)
     6             00000004   Mstr_Ctrl_Graph_Mode_En  EQU  $04       ; Enable the Graphic Mode
     7             00000008   Mstr_Ctrl_Bitmap_En      EQU  $08       ; Enable the Bitmap Module In Vicky
     8             00000010   Mstr_Ctrl_TileMap_En     EQU  $10       ; Enable the Tile Module in Vicky
     9             00000020   Mstr_Ctrl_Sprite_En      EQU  $20       ; Enable the Sprite Module in Vicky
    10             00000040   Mstr_Ctrl_GAMMA_En       EQU  $40       ; this Enable the GAMMA correction - The Analog and DVI ha
                    ve different color value, the GAMMA is great to correct the difference
    11             00000080   Mstr_Ctrl_Disable_Vid    EQU  $80       ; This will disable the Scanning of the Video hence giving
                     100% bandwith to the CPU
    12             00AF0001   MASTER_CTRL_REG_H	       EQU  $AF0001
    13                        ; Reserved - TBD
    14             00AF0002   VKY_RESERVED_00          EQU  $AF0002
    15             00AF0003   VKY_RESERVED_01          EQU  $AF0003
    16             00AF0004   BORDER_CTRL_REG          EQU  $AF0004
    17             00000001   Border_Ctrl_Enable       EQU  $01
    18                        
    19             00AF0005   BORDER_COLOR_B           EQU  $AF0005
    20             00AF0006   BORDER_COLOR_G           EQU  $AF0006
    21             00AF0007   BORDER_COLOR_R           EQU  $AF0007
    22                        
    23             00AF0008   BACKGROUND_COLOR_B       EQU  $AF0008 ; When in Graphic Mode, if a pixel is "0" then the Backgroun
                    d pixel is chosen
    24             00AF0009   BACKGROUND_COLOR_G       EQU  $AF0009
    25             00AF000A   BACKGROUND_COLOR_R       EQU  $AF000A ;
    26                        
    27             00AF0010   VKY_TXT_CURSOR_CTRL_REG  EQU  $AF0010   ;[0]  Enable Text Mode
  Sat Jul 10 2021  1:15                                                                                                Page 6

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    28             00000001   Vky_Cursor_Enable        EQU  $01
    29             00000002   Vky_Cursor_Flash_Rate0   EQU  $02
    30             00000004   Vky_Cursor_Flash_Rate1   EQU  $04
    31             00000008   Vky_Cursor_FONT_Page0    EQU  $08       ; Pick Font Page 0 or Font Page 1
    32             00000010   Vky_Cursor_FONT_Page1    EQU  $10       ; Pick Font Page 0 or Font Page 1
    33             00AF0011   VKY_TXT_RESERVED         EQU  $AF0011   ;Not in Use
    34             00AF0012   VKY_TXT_CURSOR_CHAR_REG  EQU  $AF0012
    35                        
    36             00AF0013   VKY_TXT_CURSOR_COLR_REG  EQU  $AF0013
    37             00AF0014   VKY_TXT_CURSOR_X_REG_L   EQU  $AF0014
    38             00AF0015   VKY_TXT_CURSOR_X_REG_H   EQU  $AF0015
    39             00AF0016   VKY_TXT_CURSOR_Y_REG_L   EQU  $AF0016
    40             00AF0017   VKY_TXT_CURSOR_Y_REG_H   EQU  $AF0017
    41                        
    42             00AF001C   VKY_INFO_CHIP_NUM_L      EQU  $AF001C
    43             00AF001D   VKY_INFO_CHIP_NUM_H      EQU  $AF001D
    44             00AF001E   VKY_INFO_CHIP_VER_L      EQU  $AF001E
    45             00AF001F   VKY_INFO_CHIP_VER_H      EQU  $AF001F
    46                        
    47                        ;
    48                        ; Bit Field Definition for the Control Register
    49             00000001   TILE_Enable              EQU  $01
    50             00000002   TILE_LUT0                EQU  $02
    51             00000004   TILE_LUT1                EQU  $04
    52             00000008   TILE_LUT2                EQU  $08
    53             00000080   TILESHEET_256x256_En     EQU  $80   ; 0 -> Sequential, 1-> 256x256 Tile Sheet Striding
    54                        ;
    55                        ;Tile MAP Layer 0 Registers
    56             00AF0100   TL0_CONTROL_REG          EQU  $AF0100       ; Bit[0] - Enable, Bit[3:1] - LUT Select,
    57             00AF0101   TL0_START_ADDY_L         EQU  $AF0101       ; Not USed right now - Starting Address to where is th
                    e MAP
    58             00AF0102   TL0_START_ADDY_M         EQU  $AF0102
    59             00AF0103   TL0_START_ADDY_H         EQU  $AF0103
    60             00AF0104   TL0_MAP_X_STRIDE_L       EQU  $AF0104       ; The Stride of the Map
    61             00AF0105   TL0_MAP_X_STRIDE_H       EQU  $AF0105
    62             00AF0106   TL0_MAP_Y_STRIDE_L       EQU  $AF0106       ; The Stride of the Map
    63             00AF0107   TL0_MAP_Y_STRIDE_H       EQU  $AF0107
    64                        ;TL0_RESERVED_0           EQU  $AF0108
    65                        ;TL0_RESERVED_1           EQU  $AF0109
    66                        ;TL0_RESERVED_2           EQU  $AF010A
    67                        ;TL0_RESERVED_3           EQU  $AF010B
    68                        ;TL0_RESERVED_4           EQU  $AF010C
    69                        ;TL0_RESERVED_5           EQU  $AF010D
    70                        ;TL0_RESERVED_6           EQU  $AF010E
    71                        ;TL0_RESERVED_7           EQU  $AF010F
    72                        ;Tile MAP Layer 1 Registers
    73             00AF0108   TL1_CONTROL_REG          EQU  $AF0108       ; Bit[0] - Enable, Bit[3:1] - LUT Select,
    74             00AF0109   TL1_START_ADDY_L         EQU  $AF0109       ; Not USed right now - Starting Address to where is th
                    e MAP
    75             00AF010A   TL1_START_ADDY_M         EQU  $AF010A
    76             00AF010B   TL1_START_ADDY_H         EQU  $AF010B
    77             00AF010C   TL1_MAP_X_STRIDE_L       EQU  $AF010C       ; The Stride of the Map
    78             00AF010D   TL1_MAP_X_STRIDE_H       EQU  $AF010D
    79             00AF010E   TL1_MAP_Y_STRIDE_L       EQU  $AF010E       ; The Stride of the Map
    80             00AF010F   TL1_MAP_Y_STRIDE_H       EQU  $AF010F
  Sat Jul 10 2021  1:15                                                                                                Page 7

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    81                        ;TL1_RESERVED_0           EQU  $AF0118
    82                        ;TL1_RESERVED_1           EQU  $AF0119
    83                        ;TL1_RESERVED_2           EQU  $AF011A
    84                        ;TL1_RESERVED_3           EQU  $AF011B
    85                        ;TL1_RESERVED_4           EQU  $AF011C
    86                        ;TL1_RESERVED_5           EQU  $AF011D
    87                        ;TL1_RESERVED_6           EQU  $AF011E
    88                        ;TL1_RESERVED_7           EQU  $AF011F
    89                        ;Tile MAP Layer 2 Registers
    90             00AF0110   TL2_CONTROL_REG          EQU  $AF0110       ; Bit[0] - Enable, Bit[3:1] - LUT Select,
    91             00AF0111   TL2_START_ADDY_L         EQU  $AF0111       ; Not USed right now - Starting Address to where is th
                    e MAP
    92             00AF0112   TL2_START_ADDY_M         EQU  $AF0112
    93             00AF0113   TL2_START_ADDY_H         EQU  $AF0113
    94             00AF0114   TL2_MAP_X_STRIDE_L       EQU  $AF0114       ; The Stride of the Map
    95             00AF0115   TL2_MAP_X_STRIDE_H       EQU  $AF0115
    96             00AF0116   TL2_MAP_Y_STRIDE_L       EQU  $AF0116       ; The Stride of the Map
    97             00AF0117   TL2_MAP_Y_STRIDE_H       EQU  $AF0117
    98                        ;TL2_RESERVED_0           EQU  $AF0128
    99                        ;TL2_RESERVED_1           EQU  $AF0129
   100                        ;TL2_RESERVED_2           EQU  $AF012A
   101                        ;TL2_RESERVED_3           EQU  $AF012B
   102                        ;TL2_RESERVED_4           EQU  $AF012C
   103                        ;TL2_RESERVED_5           EQU  $AF012D
   104                        ;TL2_RESERVED_6           EQU  $AF012E
   105                        ;TL2_RESERVED_7           EQU  $AF012F
   106                        ;Tile MAP Layer 3 Registers
   107             00AF0118   TL3_CONTROL_REG          EQU  $AF0118       ; Bit[0] - Enable, Bit[3:1] - LUT Select,
   108             00AF0119   TL3_START_ADDY_L         EQU  $AF0119       ; Not USed right now - Starting Address to where is th
                    e MAP
   109             00AF011A   TL3_START_ADDY_M         EQU  $AF011A
   110             00AF011B   TL3_START_ADDY_H         EQU  $AF011B
   111             00AF011C   TL3_MAP_X_STRIDE_L       EQU  $AF011C       ; The Stride of the Map
   112             00AF011D   TL3_MAP_X_STRIDE_H       EQU  $AF011D
   113             00AF011E   TL3_MAP_Y_STRIDE_L       EQU  $AF011E       ; The Stride of the Map
   114             00AF011F   TL3_MAP_Y_STRIDE_H       EQU  $AF011F
   115                        ;TL3_RESERVED_0           EQU  $AF0138
   116                        ;TL3_RESERVED_1           EQU  $AF0139
   117                        ;TL3_RESERVED_2           EQU  $AF013A
   118                        ;TL3_RESERVED_3           EQU  $AF013B
   119                        ;TL3_RESERVED_4           EQU  $AF013C
   120                        ;TL3_RESERVED_5           EQU  $AF013D
   121                        ;TL3_RESERVED_6           EQU  $AF013E
   122                        ;TL3_RESERVED_7           EQU  $AF013F
   123                        ;Bitmap Registers
   124             00AF0140   BM_CONTROL_REG           EQU  $AF0140
   125             00AF0141   BM_START_ADDY_L          EQU  $AF0141
   126             00AF0142   BM_START_ADDY_M          EQU  $AF0142
   127             00AF0143   BM_START_ADDY_H          EQU  $AF0143
   128             00AF0144   BM_X_SIZE_L              EQU  $AF0144
   129             00AF0145   BM_X_SIZE_H              EQU  $AF0145
   130             00AF0146   BM_Y_SIZE_L              EQU  $AF0146
   131             00AF0147   BM_Y_SIZE_H              EQU  $AF0147
   132             00AF0148   BM_RESERVED_0            EQU  $AF0148
   133             00AF0149   BM_RESERVED_1            EQU  $AF0149
  Sat Jul 10 2021  1:15                                                                                                Page 8

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   134             00AF014A   BM_RESERVED_2            EQU  $AF014A
   135             00AF014B   BM_RESERVED_3            EQU  $AF014B
   136             00AF014C   BM_RESERVED_4            EQU  $AF014C
   137             00AF014D   BM_RESERVED_5            EQU  $AF014D
   138             00AF014E   BM_RESERVED_6            EQU  $AF014E
   139             00AF014F   BM_RESERVED_7            EQU  $AF014F
   140                        ;Sprite Registers
   141                        ; Bit Field Definition for the Control Register
   142             00000001   SPRITE_Enable              EQU  $01
   143             00000002   SPRITE_LUT0                EQU  $02 ; This is the LUT that the Sprite will use
   144             00000004   SPRITE_LUT1                EQU  $04
   145             00000008   SPRITE_LUT2                EQU  $08 ; Only 4 LUT for Now, So this bit is not used.
   146             00000010   SPRITE_DEPTH0              EQU  $10 ; This is the Layer the Sprite will be Displayed in
   147             00000020   SPRITE_DEPTH1              EQU  $20
   148             00000040   SPRITE_DEPTH2              EQU  $40
   149                        
   150                        ; Sprite 0 (Highest Priority)
   151             00AF0200   SP00_CONTROL_REG         EQU  $AF0200
   152             00AF0201   SP00_ADDY_PTR_L          EQU  $AF0201
   153             00AF0202   SP00_ADDY_PTR_M          EQU  $AF0202
   154             00AF0203   SP00_ADDY_PTR_H          EQU  $AF0203
   155             00AF0204   SP00_X_POS_L             EQU  $AF0204
   156             00AF0205   SP00_X_POS_H             EQU  $AF0205
   157             00AF0206   SP00_Y_POS_L             EQU  $AF0206
   158             00AF0207   SP00_Y_POS_H             EQU  $AF0207
   159                        ; Sprite 1
   160             00AF0208   SP01_CONTROL_REG         EQU  $AF0208
   161             00AF0209   SP01_ADDY_PTR_L          EQU  $AF0209
   162             00AF020A   SP01_ADDY_PTR_M          EQU  $AF020A
   163             00AF020B   SP01_ADDY_PTR_H          EQU  $AF020B
   164             00AF020C   SP01_X_POS_L             EQU  $AF020C
   165             00AF020D   SP01_X_POS_H             EQU  $AF020D
   166             00AF020E   SP01_Y_POS_L             EQU  $AF020E
   167             00AF020F   SP01_Y_POS_H             EQU  $AF020F
   168                        ; Sprite 2
   169             00AF0210   SP02_CONTROL_REG         EQU  $AF0210
   170             00AF0211   SP02_ADDY_PTR_L          EQU  $AF0211
   171             00AF0212   SP02_ADDY_PTR_M          EQU  $AF0212
   172             00AF0213   SP02_ADDY_PTR_H          EQU  $AF0213
   173             00AF0214   SP02_X_POS_L             EQU  $AF0214
   174             00AF0215   SP02_X_POS_H             EQU  $AF0215
   175             00AF0216   SP02_Y_POS_L             EQU  $AF0216
   176             00AF0217   SP02_Y_POS_H             EQU  $AF0217
   177                        ; Sprite 3
   178             00AF0218   SP03_CONTROL_REG         EQU  $AF0218
   179             00AF0219   SP03_ADDY_PTR_L          EQU  $AF0219
   180             00AF021A   SP03_ADDY_PTR_M          EQU  $AF021A
   181             00AF021B   SP03_ADDY_PTR_H          EQU  $AF021B
   182             00AF021C   SP03_X_POS_L             EQU  $AF021C
   183             00AF021D   SP03_X_POS_H             EQU  $AF021D
   184             00AF021E   SP03_Y_POS_L             EQU  $AF021E
   185             00AF021F   SP03_Y_POS_H             EQU  $AF021F
   186                        ; Sprite 4
   187             00AF0220   SP04_CONTROL_REG         EQU  $AF0220
   188             00AF0221   SP04_ADDY_PTR_L          EQU  $AF0221
  Sat Jul 10 2021  1:15                                                                                                Page 9

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   189             00AF0222   SP04_ADDY_PTR_M          EQU  $AF0222
   190             00AF0223   SP04_ADDY_PTR_H          EQU  $AF0223
   191             00AF0224   SP04_X_POS_L             EQU  $AF0224
   192             00AF0225   SP04_X_POS_H             EQU  $AF0225
   193             00AF0226   SP04_Y_POS_L             EQU  $AF0226
   194             00AF0227   SP04_Y_POS_H             EQU  $AF0227
   195                        ; Sprite 5
   196             00AF0228   SP05_CONTROL_REG         EQU  $AF0228
   197             00AF0229   SP05_ADDY_PTR_L          EQU  $AF0229
   198             00AF022A   SP05_ADDY_PTR_M          EQU  $AF022A
   199             00AF022B   SP05_ADDY_PTR_H          EQU  $AF022B
   200             00AF022C   SP05_X_POS_L             EQU  $AF022C
   201             00AF022D   SP05_X_POS_H             EQU  $AF022D
   202             00AF022E   SP05_Y_POS_L             EQU  $AF022E
   203             00AF022F   SP05_Y_POS_H             EQU  $AF022F
   204                        ; Sprite 6
   205             00AF0230   SP06_CONTROL_REG         EQU  $AF0230
   206             00AF0231   SP06_ADDY_PTR_L          EQU  $AF0231
   207             00AF0232   SP06_ADDY_PTR_M          EQU  $AF0232
   208             00AF0233   SP06_ADDY_PTR_H          EQU  $AF0233
   209             00AF0234   SP06_X_POS_L             EQU  $AF0234
   210             00AF0235   SP06_X_POS_H             EQU  $AF0235
   211             00AF0236   SP06_Y_POS_L             EQU  $AF0236
   212             00AF0237   SP06_Y_POS_H             EQU  $AF0237
   213                        ; Sprite 7
   214             00AF0238   SP07_CONTROL_REG         EQU  $AF0238
   215             00AF0239   SP07_ADDY_PTR_L          EQU  $AF0239
   216             00AF023A   SP07_ADDY_PTR_M          EQU  $AF023A
   217             00AF023B   SP07_ADDY_PTR_H          EQU  $AF023B
   218             00AF023C   SP07_X_POS_L             EQU  $AF023C
   219             00AF023D   SP07_X_POS_H             EQU  $AF023D
   220             00AF023E   SP07_Y_POS_L             EQU  $AF023E
   221             00AF023F   SP07_Y_POS_H             EQU  $AF023F
   222                        ; Sprite 8
   223             00AF0240   SP08_CONTROL_REG         EQU  $AF0240
   224             00AF0241   SP08_ADDY_PTR_L          EQU  $AF0241
   225             00AF0242   SP08_ADDY_PTR_M          EQU  $AF0242
   226             00AF0243   SP08_ADDY_PTR_H          EQU  $AF0243
   227             00AF0244   SP08_X_POS_L             EQU  $AF0244
   228             00AF0245   SP08_X_POS_H             EQU  $AF0245
   229             00AF0246   SP08_Y_POS_L             EQU  $AF0246
   230             00AF0247   SP08_Y_POS_H             EQU  $AF0247
   231                        ; Sprite 9
   232             00AF0248   SP09_CONTROL_REG         EQU  $AF0248
   233             00AF0249   SP09_ADDY_PTR_L          EQU  $AF0249
   234             00AF024A   SP09_ADDY_PTR_M          EQU  $AF024A
   235             00AF024B   SP09_ADDY_PTR_H          EQU  $AF024B
   236             00AF024C   SP09_X_POS_L             EQU  $AF024C
   237             00AF024D   SP09_X_POS_H             EQU  $AF024D
   238             00AF024E   SP09_Y_POS_L             EQU  $AF024E
   239             00AF024F   SP09_Y_POS_H             EQU  $AF024F
   240                        ; Sprite 10
   241             00AF0250   SP10_CONTROL_REG         EQU  $AF0250
   242             00AF0251   SP10_ADDY_PTR_L          EQU  $AF0251
   243             00AF0252   SP10_ADDY_PTR_M          EQU  $AF0252
  Sat Jul 10 2021  1:15                                                                                                Page 10

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   244             00AF0253   SP10_ADDY_PTR_H          EQU  $AF0253
   245             00AF0254   SP10_X_POS_L             EQU  $AF0254
   246             00AF0255   SP10_X_POS_H             EQU  $AF0255
   247             00AF0256   SP10_Y_POS_L             EQU  $AF0256
   248             00AF0257   SP10_Y_POS_H             EQU  $AF0257
   249                        ; Sprite 11
   250             00AF0258   SP11_CONTROL_REG         EQU  $AF0258
   251             00AF0259   SP11_ADDY_PTR_L          EQU  $AF0259
   252             00AF025A   SP11_ADDY_PTR_M          EQU  $AF025A
   253             00AF025B   SP11_ADDY_PTR_H          EQU  $AF025B
   254             00AF025C   SP11_X_POS_L             EQU  $AF025C
   255             00AF025D   SP11_X_POS_H             EQU  $AF025D
   256             00AF025E   SP11_Y_POS_L             EQU  $AF025E
   257             00AF025F   SP11_Y_POS_H             EQU  $AF025F
   258                        ; Sprite 12
   259             00AF0260   SP12_CONTROL_REG         EQU  $AF0260
   260             00AF0261   SP12_ADDY_PTR_L          EQU  $AF0261
   261             00AF0262   SP12_ADDY_PTR_M          EQU  $AF0262
   262             00AF0263   SP12_ADDY_PTR_H          EQU  $AF0263
   263             00AF0264   SP12_X_POS_L             EQU  $AF0264
   264             00AF0265   SP12_X_POS_H             EQU  $AF0265
   265             00AF0266   SP12_Y_POS_L             EQU  $AF0266
   266             00AF0267   SP12_Y_POS_H             EQU  $AF0267
   267                        ; Sprite 13
   268             00AF0268   SP13_CONTROL_REG         EQU  $AF0268
   269             00AF0269   SP13_ADDY_PTR_L          EQU  $AF0269
   270             00AF026A   SP13_ADDY_PTR_M          EQU  $AF026A
   271             00AF026B   SP13_ADDY_PTR_H          EQU  $AF026B
   272             00AF026C   SP13_X_POS_L             EQU  $AF026C
   273             00AF026D   SP13_X_POS_H             EQU  $AF026D
   274             00AF026E   SP13_Y_POS_L             EQU  $AF026E
   275             00AF026F   SP13_Y_POS_H             EQU  $AF026F
   276                        ; Sprite 14
   277             00AF0270   SP14_CONTROL_REG         EQU  $AF0270
   278             00AF0271   SP14_ADDY_PTR_L          EQU  $AF0271
   279             00AF0272   SP14_ADDY_PTR_M          EQU  $AF0272
   280             00AF0273   SP14_ADDY_PTR_H          EQU  $AF0273
   281             00AF0274   SP14_X_POS_L             EQU  $AF0274
   282             00AF0275   SP14_X_POS_H             EQU  $AF0275
   283             00AF0276   SP14_Y_POS_L             EQU  $AF0276
   284             00AF0277   SP14_Y_POS_H             EQU  $AF0277
   285                        ; Sprite 15
   286             00AF0278   SP15_CONTROL_REG         EQU  $AF0278
   287             00AF0279   SP15_ADDY_PTR_L          EQU  $AF0279
   288             00AF027A   SP15_ADDY_PTR_M          EQU  $AF027A
   289             00AF027B   SP15_ADDY_PTR_H          EQU  $AF027B
   290             00AF027C   SP15_X_POS_L             EQU  $AF027C
   291             00AF027D   SP15_X_POS_H             EQU  $AF027D
   292             00AF027E   SP15_Y_POS_L             EQU  $AF027E
   293             00AF027F   SP15_Y_POS_H             EQU  $AF027F
   294                        ; Sprite 16
   295             00AF0280   SP16_CONTROL_REG         EQU  $AF0280
   296             00AF0281   SP16_ADDY_PTR_L          EQU  $AF0281
   297             00AF0282   SP16_ADDY_PTR_M          EQU  $AF0282
   298             00AF0283   SP16_ADDY_PTR_H          EQU  $AF0283
  Sat Jul 10 2021  1:15                                                                                                Page 11

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   299             00AF0284   SP16_X_POS_L             EQU  $AF0284
   300             00AF0285   SP16_X_POS_H             EQU  $AF0285
   301             00AF0286   SP16_Y_POS_L             EQU  $AF0286
   302             00AF0287   SP16_Y_POS_H             EQU  $AF0287
   303                        ; Sprite 17
   304             00AF0288   SP17_CONTROL_REG         EQU  $AF0288
   305             00AF0289   SP17_ADDY_PTR_L          EQU  $AF0289
   306             00AF028A   SP17_ADDY_PTR_M          EQU  $AF028A
   307             00AF028B   SP17_ADDY_PTR_H          EQU  $AF028B
   308             00AF028C   SP17_X_POS_L             EQU  $AF028C
   309             00AF028D   SP17_X_POS_H             EQU  $AF028D
   310             00AF028E   SP17_Y_POS_L             EQU  $AF028E
   311             00AF028F   SP17_Y_POS_H             EQU  $AF028F
   312                        ; DMA Controller $AF0400 - $AF04FF
   313             00AF0400   VDMA_CONTROL_REG         EQU  $AF0400
   314             00AF0401   VDMA_COUNT_REG_L         EQU  $AF0401
   315             00AF0402   VDMA_COUNT_REG_M         EQU  $AF0402
   316             00AF0403   VDMA_COUNT_REG_H         EQU  $AF0403
   317             00AF0404   VDMA_DATA_2_WRITE_L      EQU  $AF0404
   318             00AF0405   VDMA_DATA_2_WRITE_H      EQU  $AF0405
   319             00AF0406   VDMA_STRIDE_L            EQU  $AF0406
   320             00AF0407   VDMA_STRIDE_H            EQU  $AF0407
   321             00AF0408   VDMA_SRC_ADDY_L          EQU  $AF0408
   322             00AF0409   VDMA_SRC_ADDY_M          EQU  $AF0409
   323             00AF040A   VDMA_SRC_ADDY_H          EQU  $AF040A
   324             00AF040B   VDMA_RESERVED_0          EQU  $AF040B
   325             00AF040C   VDMA_DST_ADDY_L          EQU  $AF040C
   326             00AF040D   VDMA_DST_ADDY_M          EQU  $AF040D
   327             00AF040E   VDMA_DST_ADDY_H          EQU  $AF040E
   328             00AF040F   VDMA_RESERVED_1          EQU  $AF040F
   329                        
   330                        ; Mouse Pointer Graphic Memory
   331             00AF0500   MOUSE_PTR_GRAP0_START     EQU  $AF0500 ; 16 x 16  EQU  256 Pixels (Grey Scale) 0  EQU  Transparent
                    , 1  EQU  Black , 255  EQU  White
   332             00AF05FF   MOUSE_PTR_GRAP0_END       EQU  $AF05FF ; Pointer 0
   333             00AF0600   MOUSE_PTR_GRAP1_START     EQU  $AF0600 ;
   334             00AF06FF   MOUSE_PTR_GRAP1_END       EQU  $AF06FF ; Pointer 1
   335                        
   336             00AF0700   MOUSE_PTR_CTRL_REG_L     EQU  $AF0700 ; Bit[0] Enable, Bit[1]  EQU  0  ( 0  EQU  Pointer0, 1  EQU 
                     Pointer1)
   337             00AF0701   MOUSE_PTR_CTRL_REG_H     EQU  $AF0701 ;
   338             00AF0702   MOUSE_PTR_X_POS_L        EQU  $AF0702 ; X Position (0 - 639) (Can only read now) Writing will have
                     no effect
   339             00AF0703   MOUSE_PTR_X_POS_H        EQU  $AF0703 ;
   340             00AF0704   MOUSE_PTR_Y_POS_L        EQU  $AF0704 ; Y Position (0 - 479) (Can only read now) Writing will have
                     no effect
   341             00AF0705   MOUSE_PTR_Y_POS_H        EQU  $AF0705 ;
   342             00AF0706   MOUSE_PTR_BYTE0          EQU  $AF0706 ; Byte 0 of Mouse Packet (you must write 3 Bytes)
   343             00AF0707   MOUSE_PTR_BYTE1          EQU  $AF0707 ; Byte 1 of Mouse Packet (if you don't, then )
   344             00AF0708   MOUSE_PTR_BYTE2          EQU  $AF0708 ; Byte 2 of Mouse Packet (state Machine will be jammed in 1 
                    state)
   345                                                          ; (And the mouse won't work)
   346             00AF070B   C256F_MODEL_MAJOR        EQU  $AF070B ;
   347             00AF070C   C256F_MODEL_MINOR        EQU  $AF070C ;
   348             00AF070D   FPGA_DOR                 EQU  $AF070D ;
  Sat Jul 10 2021  1:15                                                                                                Page 12

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   349             00AF070E   FPGA_MOR                 EQU  $AF070E ;
   350             00AF070F   FPGA_YOR                 EQU  $AF070F ;
   351                        
   352                        ;                        EQU  $AF0800 ; the RTC is Here
   353                        ;                        EQU  $AF1000 ; The SuperIO Start is Here
   354                        ;                        EQU  $AF13FF ; The SuperIO Start is Here
   355                        
   356             00AF1F40   FG_CHAR_LUT_PTR          EQU  $AF1F40
   357             00AF1F80   BG_CHAR_LUT_PTR		       EQU  $AF1F80
   358                        
   359             00AF2000   GRPH_LUT0_PTR		         EQU  $AF2000
   360             00AF2400   GRPH_LUT1_PTR		         EQU  $AF2400
   361             00AF2800   GRPH_LUT2_PTR		         EQU  $AF2800
   362             00AF2C00   GRPH_LUT3_PTR		         EQU  $AF2C00
   363             00AF3000   GRPH_LUT4_PTR		         EQU  $AF3000
   364             00AF3400   GRPH_LUT5_PTR		         EQU  $AF3400
   365             00AF3800   GRPH_LUT6_PTR		         EQU  $AF3800
   366             00AF3C00   GRPH_LUT7_PTR		         EQU  $AF3C00
   367                        
   368             00AF4000   GAMMA_B_LUT_PTR		       EQU  $AF4000
   369             00AF4100   GAMMA_G_LUT_PTR		       EQU  $AF4100
   370             00AF4200   GAMMA_R_LUT_PTR		       EQU  $AF4200
   371                        
   372             00AF5000   TILE_MAP0       		     EQU  $AF5000     ;$AF5000 - $AF57FF
   373             00AF5800   TILE_MAP1                EQU  $AF5800     ;$AF5800 - $AF5FFF
   374             00AF6000   TILE_MAP2                EQU  $AF6000     ;$AF6000 - $AF67FF
   375             00AF6800   TILE_MAP3                EQU  $AF6800     ;$AF6800 - $AF6FFF
   376                        
   377             00AF8000   FONT_MEMORY_BANK0        EQU  $AF8000     ;$AF8000 - $AF87FF
   378             00AF8800   FONT_MEMORY_BANK1        EQU  $AF8800     ;$AF8800 - $AF8FFF
   379             00AFA000   CS_TEXT_MEM_PTR          EQU  $AFA000
   380             00AFC000   CS_COLOR_MEM_PTR         EQU  $AFC000
   381                        
   382                        
   383             00AFE000   BTX_START                EQU  $AFE000     ; BEATRIX Registers
   384             00AFFFFF   BTX_END                  EQU  $AFFFFF
   385                        
   386                        ; Line Interrupt Registers
   387             00AF001B   VKY_LINE_IRQ_CTRL_REG    EQU  $AF001B ;[0] - Enable Line 0, [1] -Enable Line 1
   388             00AF001C   VKY_LINE0_CMP_VALUE_LO   EQU  $AF001C ;Write Only [7:0]
   389             00AF001D   VKY_LINE0_CMP_VALUE_HI   EQU  $AF001D ;Write Only [3:0]
   390             00AF001E   VKY_LINE1_CMP_VALUE_LO   EQU  $AF001E ;Write Only [7:0]
   391             00AF001F   VKY_LINE1_CMP_VALUE_HI   EQU  $AF001F ;Write Only [3:0]
   392                        
    36                        	INCLUDE keyboard_def.asm
     1                        ;
     2                        
     3                        
     4                        
     5                        ; Register addresses
     6                        	IF	SYS_C256_FMX
     7                        
     8                        STATUS_PORT 	EQU $AF1064
     9                        KBD_STATUS      EQU $AF1064
    10                        KBD_CMD_BUF		EQU $AF1064
  Sat Jul 10 2021  1:15                                                                                                Page 13

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    11                        KBD_OUT_BUF 	EQU $AF1060
    12                        KBD_INPT_BUF	EQU $AF1060
    13                        KBD_DATA_BUF	EQU $AF1060
    14                        PORT_A		    EQU $AF1060
    15                        PORT_B			EQU $AF1061
    16                        
    17                        	ELSE
    18                        
    19             00AF1807   STATUS_PORT 	EQU $AF1807
    20             00AF1807   KBD_STATUS      EQU $AF1807
    21             00AF1807   KBD_CMD_BUF		EQU $AF1807
    22             00AF1803   KBD_OUT_BUF 	EQU $AF1803
    23             00AF1803   KBD_INPT_BUF	EQU $AF1803
    24             00AF1803   KBD_DATA_BUF	EQU $AF1803
    25             00AF180A   PORT_A		    EQU $AF180A   ;This is a Timing Register, the value is hard coded, so there 
                    is no need to use those
    26             00AF180B   PORT_B			EQU $AF180B   ;This is a Timing Register, the value is hard coded, so th
                    ere is no need to use those
    27                        
    28                        	ENDIF
    29                        
    30                        
    31                        ; Status
    32             00000001   OUT_BUF_FULL   EQU 	$01
    33             00000002   INPT_BUF_FULL	 EQU 	$02
    34             00000004   SYS_FLAG		   EQU 	$04
    35             00000008   CMD_DATA		   EQU 	$08
    36             00000010   KEYBD_INH      EQU 	$10
    37             00000020   TRANS_TMOUT	   EQU 	$20
    38             00000040   RCV_TMOUT		   EQU 	$40
    39             00000080   PARITY_EVEN		 EQU 	$80
    40             00000010   INH_KEYBOARD	 EQU 	$10
    41             000000AE   KBD_ENA			   EQU 	$AE
    42             000000AD   KBD_DIS			   EQU 	$AD
    43                        
    44                        ; Keyboard Commands
    45             000000F1   KB_MENU			   EQU 	$F1
    46             000000F4   KB_ENABLE		   EQU 	$F4
    47             000000F7   KB_MAKEBREAK   EQU 	$F7
    48             000000FE   KB_ECHO			   EQU 	$FE
    49             000000FF   KB_RESET		   EQU 	$FF
    50             000000ED   KB_LED_CMD		 EQU 	$ED
    51                        
    52                        ; Keyboard responses
    53             000000AA   KB_OK			     EQU 	$AA
    54             000000FA   KB_ACK			   EQU 	$FA
    55             000000FF   KB_OVERRUN		 EQU 	$FF
    56             000000FE   KB_RESEND		   EQU 	$FE
    57             000000F0   KB_BREAK		   EQU 	$F0
    58             00000010   KB_FA			     EQU 	$10
    59             00000020   KB_FE			     EQU 	$20
    60             00000040   KB_PR_LED		   EQU 	$40
    37                        	INCLUDE timer_def.asm
     1                        ; Pending Interrupt (Read and Write Back to Clear)
     2                        ; TIMER0
  Sat Jul 10 2021  1:15                                                                                                Page 14

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

     3             00000160   TIMER0_CTRL_REG   EQU $000160 ; (Write - Control, Read Status)
     4                        ; Control Register Definitions
     5             00000001   TMR0_EN     EQU $01
     6             00000002   TMR0_SCLR   EQU $02
     7             00000004   TMR0_SLOAD  EQU $04 ; Use SLOAD is
     8             00000008   TMR0_UPDWN  EQU $08
     9                        
    10             00000161   TIMER0_CHARGE_L   EQU $000161 ; Use if you want to Precharge and countdown
    11             00000162   TIMER0_CHARGE_M   EQU $000162 ;
    12             00000163   TIMER0_CHARGE_H   EQU $000163 ;
    13                        ; Compare Block
    14             00000164   TIMER0_CMP_REG    EQU $000164 ;
    15             00000001   TMR0_CMP_RECLR     EQU $01 ; set to one for it to cycle when Counting up
    16             00000002   TMR0_CMP_RELOAD    EQU $02 ; Set to one for it to reload when Counting Down
    17                        
    18             00000165   TIMER0_CMP_L      EQU $000165 ; Load this Value for Countup
    19             00000166   TIMER0_CMP_M      EQU $000166 ;
    20             00000167   TIMER0_CMP_H      EQU $000167 ;
    21                        ; Pending Interrupt (Read and Write Back to Clear)
    22                        ; TIMER1
    23             00000168   TIMER1_CTRL_REG   EQU $000168 ;
    24             00000001   TMR1_EN     EQU $01
    25             00000002   TMR1_SCLR   EQU $02
    26             00000004   TMR1_SLOAD  EQU $04
    27             00000008   TMR1_UPDWN  EQU $08 ; 1 = Up, 0 = Down
    28             00000169   TIMER1_CHARGE_L   EQU $000169 ; Use if you want to Precharge and countdown
    29             0000016A   TIMER1_CHARGE_M   EQU $00016A ;
    30             0000016B   TIMER1_CHARGE_H   EQU $00016B ;
    31                        ; Compare Block
    32             0000016C   TIMER1_CMP_REG    EQU $00016C ;
    33             00000001   TMR1_CMP_RECLR     EQU $01 ; set to one for it to cycle when Counting up
    34             00000002   TMR1_CMP_RELOAD    EQU $02 ; Set to one for it to reload when Counting Down
    35             0000016D   TIMER1_CMP_L      EQU $00016D ;
    36             0000016E   TIMER1_CMP_M      EQU $00016E ;
    37             0000016F   TIMER1_CMP_H      EQU $00016F ;
    38                        	INCLUDE page_00_inc.asm
     1                        ; page_00.asm
     2                        ; Direct Page Addresses
     3                        ;
     4                        ;* Addresses are the byte AFTER the block. Use this to confirm block locations and check for overl
                    aps
     5             00000000   BANK0_BEGIN       EQU  $000000 ;Start of bank 0 and Direct page
     6             00000000   unused_0000       EQU  $000000 ;12 Bytes unused
     7             00000008   OPL2_ADDY_PTR_LO  EQU  $000008  ; THis Points towards the Instruments Database
     8             00000009   OPL2_ADDY_PTR_MD  EQU  $000009
     9             0000000A   OPL2_ADDY_PTR_HI  EQU  $00000A
    10             0000000C   SCREENBEGIN       EQU  $00000C ;3 Bytes Start of screen in video RAM. This is the upper-left corrn
                    er of the current video page being written to. This may not be what's being displayed by VICKY. Update this 
                    if you change VICKY's display page.
    11             0000000F   COLS_VISIBLE      EQU  $00000F ;2 Bytes Columns visible per screen line. A virtual line can be lon
                    ger than displayed, up to COLS_PER_LINE long. Default  EQU  80
    12             00000011   COLS_PER_LINE     EQU  $000011 ;2 Bytes Columns in memory per screen line. A virtual line can be t
                    his long. Default EQU 128
    13             00000013   LINES_VISIBLE     EQU  $000013 ;2 Bytes The number of rows visible on the screen. Default EQU 25
    14             00000015   LINES_MAX         EQU  $000015 ;2 Bytes The number of rows in memory for the screen. Default EQU 6
  Sat Jul 10 2021  1:15                                                                                                Page 15

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

                    4
    15             00000017   CURSORPOS         EQU  $000017 ;3 Bytes The next character written to the screen will be written i
                    n this location.
    16             0000001A   CURSORX           EQU  $00001A ;2 Bytes This is where the blinking cursor sits. Do not edit this d
                    ireectly. Call LOCATE to update the location and handle moving the cursor correctly.
    17             0000001C   CURSORY           EQU  $00001C ;2 Bytes This is where the blinking cursor sits. Do not edit this d
                    ireectly. Call LOCATE to update the location and handle moving the cursor correctly.
    18             0000001E   CURCOLOR          EQU  $00001E ;2 Bytes Color of next character to be printed to the screen.
    19             00000020   CURATTR           EQU  $000020 ;2 Bytes Attribute of next character to be printed to the screen.
    20             00000022   STACKBOT          EQU  $000022 ;2 Bytes Lowest location the stack should be allowed to write to. I
                    f SP falls below this value, the runtime should generate STACK OVERFLOW error and abort.
    21             00000024   STACKTOP          EQU  $000024 ;2 Bytes Highest location the stack can occupy. If SP goes above th
                    is value, the runtime should generate STACK OVERFLOW error and abort.
    22                        ; OPL2 Library Variable (Can be shared if Library is not used)
    23                        ; THis will need to move eventually
    24             00000026   OPL2_OPERATOR     EQU  $000026 ;
    25             00000027   OPL2_CHANNEL      EQU  $000027 ;
    26             00000028   OPL2_REG_REGION   EQU  $000028 ; Offset to the Group of Registers
    27             0000002A   OPL2_REG_OFFSET   EQU  $00002A ; 2 Bytes (16Bits)
    28             0000002C   OPL2_IND_ADDY_LL  EQU  $00002C ; 2 Bytes Reserved (Only need 3)
    29             0000002E   OPL2_IND_ADDY_HL  EQU  $00002E ; 2 Bytes Reserved (Only need 3)
    30             00000030   OPL2_NOTE         EQU  $000030 ; 1 Byte
    31             00000031   OPL2_OCTAVE       EQU  $000031 ; 1 Byte
    32             00000032   OPL2_PARAMETER0   EQU  $000032 ; 1 Byte - Key On/Feedback
    33             00000033   OPL2_PARAMETER1   EQU  $000033 ; 1 Byte
    34             00000034   OPL2_PARAMETER2   EQU  $000034 ; 1 Byte
    35             00000035   OPL2_PARAMETER3   EQU  $000035 ; 1 Byte
    36             00000036   OPL2_LOOP         EQU  $000036 ;
    37             00000036   OPL2_BLOCK        EQU  $000036
    38                        ; SD Card (CH376S) Variables
    39             00000038   SDCARD_FILE_PTR   EQU  $000038 ; 3 Bytes Pointer to Filename to open
    40             0000003C   SDCARD_BYTE_NUM   EQU  $00003C ; 2Bytes
    41             0000003F   SDCARD_PRSNT_MNT  EQU  $00003F ; 1 Byte, Indicate that the SDCard is Present and that it is Mounte
                    d
    42                        ; Command Line Parser Variables
    43             00000040   CMD_PARSER_TMPX   EQU  $000040 ; <<< Command Parser 2Bytes
    44             00000042   CMD_PARSER_TMPY   EQU  $000042 ; <<< Command Parser 2Bytes
    45             00000044   CMD_LIST_PTR      EQU  $000044 ; <<< Command Parser 3 Bytes
    46             00000048   CMD_PARSER_PTR    EQU  $000048 ; <<< Command Parser 3 Bytes
    47             0000004B   CMD_ATTRIBUTE     EQU  $00004B ; <<< Command Parser 2 Bytes (16bits Attribute Field)
    48             0000004D   CMD_EXEC_ADDY     EQU  $00004D ; <<< Command Parser 3 Bytes 24 Bits Address Jump to execute the Co
                    mmand
    49             00000050   KEY_BUFFER_RPOS   EQU  $000050 ;
    50             00000052   KEY_BUFFER_WPOS   EQU  $000052 ;
    51             00000054   CMD_VARIABLE_TMP  EQU  $000054 ;
    52             00000056   CMD_ARG_DEV       EQU  $000056 ;
    53             00000057   CMD_ARG_SA        EQU  $000057 ;
    54             0000005A   CMD_ARG_EA        EQU  $00005A ;
    55             0000005D   CMD_VALID         EQU  $00005D ;
    56                        
    57                        
    58                        ; Bitmap Clear Routine
    59             00000040   BM_CLEAR_SCRN_X   EQU  $000040
    60             00000042   BM_CLEAR_SCRN_Y   EQU  $000042
    61                        ; RAD File Player
  Sat Jul 10 2021  1:15                                                                                                Page 16

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    62             00000040   RAD_STARTLINE     EQU  $000040 ; 1 Byte
    63             00000041   RAD_PATTERN_IDX   EQU  $000041 ; 1 Byte
    64             00000042   RAD_LINE          EQU  $000042 ; 1 Byte
    65             00000043   RAD_LINENUMBER    EQU  $000043 ; 1 Byte
    66             00000044   RAD_CHANNEL_NUM   EQU  $000044 ; 1 Byte
    67             00000045   RAD_ISLASTCHAN    EQU  $000045 ; 1 Byte
    68             00000046   RAD_Y_POINTER     EQU  $000046 ; 2 Bytes
    69             00000048   RAD_TICK          EQU  $000048
    70             0000004A   RAD_CHANNEL_DATA  EQU  $00004A ; 2 Bytes
    71             0000004C   RAD_CHANNE_EFFCT  EQU  $00004C
    72             0000004D   RAD_TEMP          EQU  $00004D
    73                        
    74                        ; BMP File Parser Variables (Can be shared if BMP Parser not used)
    75                        ; Used for Command Parser Mainly
    76             00000040   BMP_X_SIZE        EQU  $000040 ; 2 Bytes
    77             00000042   BMP_Y_SIZE        EQU  $000042 ; 2 Bytes
    78             00000044   BMP_PRSE_SRC_PTR  EQU  $000044 ; 3 Bytes
    79             00000048   BMP_PRSE_DST_PTR  EQU  $000048 ; 3 Bytes
    80             0000004C   BMP_COLOR_PALET   EQU  $00004C ; 2 Bytes
    81             0000004E   SCRN_X_STRIDE     EQU  $00004E ; 2 Bytes, Basically How many Pixel Accross in Bitmap Mode
    82             00000050   BMP_FILE_SIZE     EQU  $000050 ; 4 Bytes
    83             00000054   BMP_POSITION_X    EQU  $000054 ; 2 Bytes Where, the BMP will be position on the X Axis
    84             00000056   BMP_POSITION_Y    EQU  $000056 ; 2 Bytes Where, the BMP will be position on the Y Axis
    85             00000058   BMP_PALET_CHOICE  EQU  $000058 ;
    86                        ;Empty Region
    87                        ;XXX              EQU  $000060
    88                        ;..
    89                        ;..
    90                        ;..
    91                        ;YYY              EQU  $0000EE
    92                        
    93             000000E0   MOUSE_PTR         EQU  $0000E0
    94             000000E1   MOUSE_POS_X_LO    EQU  $0000E1
    95             000000E2   MOUSE_POS_X_HI    EQU  $0000E2
    96             000000E3   MOUSE_POS_Y_LO    EQU  $0000E3
    97             000000E4   MOUSE_POS_Y_HI    EQU  $0000E4
    98                        
    99             000000F0   USER_TEMP         EQU  $0000F0 ;32 Bytes Temp space for user programs
   100                        ;;///////////////////////////////////////////////////////////////
   101                        ;;; NO CODE or Variable ought to be Instatied in this REGION
   102                        ;; BEGIN
   103                        ;;///////////////////////////////////////////////////////////////
   104             00000100   GAVIN_BLOCK       EQU  $000100 ;256 Bytes Gavin reserved, overlaps debugging registers at $1F0
   105                        
   106             00000100   MULTIPLIER_0      EQU  $000100 ;0 Byte  Unsigned multiplier
   107             00000100   M0_OPERAND_A      EQU  $000100 ;2 Bytes Operand A (ie: A x B)
   108             00000102   M0_OPERAND_B      EQU  $000102 ;2 Bytes Operand B (ie: A x B)
   109             00000104   M0_RESULT         EQU  $000104 ;4 Bytes Result of A x B
   110                        
   111             00000108   MULTIPLIER_1      EQU  $000108 ;0 Byte  Signed Multiplier
   112             00000108   M1_OPERAND_A      EQU  $000108 ;2 Bytes Operand A (ie: A x B)
   113             0000010A   M1_OPERAND_B      EQU  $00010A ;2 Bytes Operand B (ie: A x B)
   114             0000010C   M1_RESULT         EQU  $00010C ;4 Bytes Result of A x B
   115                        
   116             00000108   DIVIDER_0         EQU  $000108 ;0 Byte  Unsigned divider
  Sat Jul 10 2021  1:15                                                                                                Page 17

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   117             00000108   D0_OPERAND_A      EQU  $000108 ;2 Bytes Divider 0 Dividend ex: A in  A/B
   118             0000010A   D0_OPERAND_B      EQU  $00010A ;2 Bytes Divider 0 Divisor ex B in A/B
   119             0000010C   D0_RESULT         EQU  $00010C ;2 Bytes Quotient result of A/B ex: 7/2  EQU  3 r 1
   120             0000010E   D0_REMAINDER      EQU  $00010E ;2 Bytes Remainder of A/B ex: 1 in 7/2 EQU 3 r 1
   121                        
   122             00000110   DIVIDER_1         EQU  $000110 ;0 Byte  Signed divider
   123             00000110   D1_OPERAND_A      EQU  $000110 ;2 Bytes Divider 1 Dividend ex: A in  A/B
   124             00000112   D1_OPERAND_B      EQU  $000112 ;2 Bytes Divider 1 Divisor ex B in A/B
   125             00000114   D1_RESULT         EQU  $000114 ;2 Bytes Signed quotient result of A/B ex: 7/2  EQU  3 r 1
   126             00000116   D1_REMAINDER      EQU  $000116 ;2 Bytes Signed remainder of A/B ex: 1 in 7/2 EQU 3 r 1
   127                        ; Reserved
   128             00000120   ADDER_SIGNED_32   EQU  $000120 ; The 32 Bit Adders takes 12Byte that are NOT RAM Location
   129                        ; Reserved
   130             00000140   INT_CONTROLLER    EQU  $000140 ; $000140...$00015F Interrupt Controller
   131                        
   132             00000160   TIMER_CONTROLLER  EQU  $000160 ; $000160...$00017F Timer0/Timer1/Timer2 Block
   133             00000160   TIMER_CTRL_REGLL  EQU  $000160 ;
   134             00000161   TIMER_CTRL_REGLH  EQU  $000161 ;
   135             00000162   TIMER_CTRL_REGHL  EQU  $000162 ;
   136             00000163   TIMER_CTRL_REGHH  EQU  $000163 ;
   137                        ;;///////////////////////////////////////////////////////////////
   138                        ;;; NO CODE or Variable ought to be Instatied in this REGION
   139                        ;; END
   140                        ;;///////////////////////////////////////////////////////////////
   141             00000240   CPU_REGISTERS     EQU  $000240 ; Byte
   142             00000240   CPUPC             EQU  $000240 ;2 Bytes Program Counter (PC)
   143             00000242   CPUPBR            EQU  $000242 ;2 Bytes Program Bank Register (K)
   144             00000244   CPUA              EQU  $000244 ;2 Bytes Accumulator (A)
   145             00000246   CPUX              EQU  $000246 ;2 Bytes X Register (X)
   146             00000248   CPUY              EQU  $000248 ;2 Bytes Y Register (Y)
   147             0000024A   CPUSTACK          EQU  $00024A ;2 Bytes Stack Pointer (S)
   148             0000024C   CPUDP             EQU  $00024C ;2 Bytes Direct Page Register (D)
   149             0000024E   CPUDBR            EQU  $00024E ;1 Byte  Data Bank Register (B)
   150             0000024F   CPUFLAGS          EQU  $00024F ;1 Byte  Flags (P)
   151                        
   152             00000250   MONITOR_VARS      EQU  $000250 ; Byte  MONITOR Variables. BASIC variables may overlap this space
   153             00000250   MCMDADDR          EQU  $000250 ;3 Bytes Address of the current line of text being processed by the
                     command parser. Can be in display memory or a variable in memory. MONITOR will parse up to MTEXTLEN charact
                    ers or to a null character.
   154             00000253   MCMP_TEXT         EQU  $000253 ;3 Bytes Address of symbol being evaluated for COMPARE routine
   155             00000256   MCMP_LEN          EQU  $000256 ;2 Bytes Length of symbol being evaluated for COMPARE routine
   156             00000258   MCMD              EQU  $000258 ;3 Bytes Address of the current command/function string
   157             0000025B   MCMD_LEN          EQU  $00025B ;2 Bytes Length of the current command/function string
   158             0000025D   MARG1             EQU  $00025D ;4 Bytes First command argument. May be data or address, depending 
                    on command
   159             00000261   MARG2             EQU  $000261 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   160             00000265   MARG3             EQU  $000265 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   161             00000269   MARG4             EQU  $000269 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   162             0000026D   MARG5             EQU  $00026D ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   163             00000271   MARG6             EQU  $000271 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
  Sat Jul 10 2021  1:15                                                                                                Page 18

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   164             00000275   MARG7             EQU  $000275 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   165             00000279   MARG8             EQU  $000279 ;4 Bytes First command argument. May be data or address, depending 
                    on command. Data is 32-bit number. Address is 24-bit address and 8-bit length.
   166                        
   167             00000300   LOADFILE_VARS     EQU  $000300 ; Byte
   168             00000300   LOADFILE_NAME     EQU  $000300 ;3 Bytes (addr) Name of file to load. Address in Data Page
   169             00000303   LOADFILE_LEN      EQU  $000303 ;1 Byte  Length of filename. 0 EQU Null Terminated
   170             00000304   LOADPBR           EQU  $000304 ;1 Byte  First Program Bank of loaded file ($05 segment)
   171             00000305   LOADPC            EQU  $000305 ;2 Bytes Start address of loaded file ($05 segment)
   172             00000307   LOADDBR           EQU  $000307 ;1 Byte  First data bank of loaded file ($06 segment)
   173             00000308   LOADADDR          EQU  $000308 ;2 Bytes FIrst data address of loaded file ($06 segment)
   174             0000030A   LOADFILE_TYPE     EQU  $00030A ;3 Bytes (addr) File type string in loaded data file. Actual string
                     data will be in Bank 1. Valid values are BIN, PRG, P16
   175             0000030D   BLOCK_LEN         EQU  $00030D ;2 Bytes Length of block being loaded
   176             0000030F   BLOCK_ADDR        EQU  $00030F ;2 Bytes (temp) Address of block being loaded
   177             00000311   BLOCK_BANK        EQU  $000311 ;1 Byte  (temp) Bank of block being loaded
   178             00000312   BLOCK_COUNT       EQU  $000312 ;2 Bytes (temp) Counter of bytes read as file is loaded
   179                        
   180                        ; $00:0320 to $00:06FF - Reserved for CH376S SDCard Controller
   181             00000320   SDOS_BLOCK_BEGIN  EQU  $000320 ;
   182             00000324   SDOS_LOAD_ADDY    EQU  $000324 ; 4 Bytes (Uses 3 Only)
   183             00000328   SDOS_FILE_SIZE    EQU  $000328 ;
   184             0000032C   SDOS_BYTE_NUMBER  EQU  $00032C ; Number of Byte to Read or Write before changing the Pointer
   185             00000330   SDOS_REG_WR32_AD  EQU  $000330 ; 4 Bytes (Used to read and Write Values in/from CH376S)
   186             00000334   SDOS_BYTE_PTR     EQU  $000334
   187             00000380   SDOS_FILE_NAME    EQU  $000380 ; // Max of 128 Chars
   188             00000400   SDOS_BLK_BEGIN    EQU  $000400 ; 512 Bytes to Store SD Card Incoming or Outcoming Block
   189             000006FF   SDOS_BLK_END      EQU  $0006FF ;
   190                        
   191             00000700   TASKSS_STACK_LO	  EQU  $000700;
   192             00000701   TASKSS_STACK_HI	  EQU  $000701;
   193             00000702   TASKSS_CALLER_LO  EQU  $000702;
   194             00000703   TASKSS_CALLER_HI  EQU  $000703;
   195             00000704   TASKSS_SOS_LO	  EQU  $000704;
   196             00000705   TASKSS_SOS_HI	  EQU  $000705;
   197                        
   198             000007F0   CURRUART	  	  EQU  $0007F0;
   199                        
   200                        ; COMMAND PARSER Variables
   201                        ; Command Parser Stuff between $000F00 -> $000F84 (see CMD_Parser.asm)
   202             00000F00   KEY_BUFFER        EQU  $000F00 ;64 Bytes keyboard buffer
   203             00000080   KEY_BUFFER_SIZE   EQU  $0080 ;128 Bytes (constant) keyboard buffer length
   204             00000F7F   KEY_BUFFER_END    EQU  $000F7F ;1 Byte  Last byte of keyboard buffer
   205             00000F83   KEY_BUFFER_CMD    EQU  $000F83 ;1 Byte  Indicates the Command Process Status
   206             00000F84   COMMAND_SIZE_STR  EQU  $000F84 ; 1 Byte
   207             00000F86   COMMAND_COMP_TMP  EQU  $000F86 ; 2 Bytes
   208             00000F87   KEYBOARD_SC_FLG   EQU  $000F87 ;1 Bytes that indicate the Status of Left Shift, Left CTRL, Left AL
                    T, Right Shift
   209             00000F88   KEYBOARD_SC_TMP   EQU  $000F88 ;1 Byte, Interrupt Save Scan Code while Processing
   210                        
   211                        
   212                        
   213             00001000   TEST_BEGIN        EQU  $001000 ;28672 Bytes Test/diagnostic code for prototype.
   214             00007FFF   TEST_END          EQU  $007FFF ;0 Byte
  Sat Jul 10 2021  1:15                                                                                                Page 19

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   215                        
   216             00008000   STACK_BEGIN       EQU  $008000 ;32512 Bytes The default beginning of stack space
   217             0000FEFF   STACK_END         EQU  $00FEFF ;0 Byte  End of stack space. Everything below this is I/O space
   218                        
   219             0018FF00   ISR_BEGIN         EQU  $18FF00 ; Byte  Beginning of CPU vectors in Direct page
   220             0018FF00   HRESET            EQU  $18FF00 ;16 Bytes Handle RESET asserted. Reboot computer and re-initialize 
                    the kernel.
   221             0018FF10   HCOP              EQU  $18FF10 ;16 Bytes Handle the COP instruction. Program use; not used by OS
   222             0018FF20   HBRK              EQU  $18FF20 ;16 Bytes Handle the BRK instruction. Returns to BASIC Ready prompt
                    .
   223             0018FF30   HABORT            EQU  $18FF30 ;16 Bytes Handle ABORT asserted. Return to Ready prompt with an err
                    or message.
   224             0018FF40   HNMI              EQU  $18FF40 ;32 Bytes Handle NMI
   225             0018FF60   HIRQ              EQU  $18FF60 ;32 Bytes Handle IRQ
   226             0018FF80   Unused_FF80       EQU  $18FF80 ;End of direct page Interrrupt handlers
   227                        
   228             0018FFE0   VECTORS_BEGIN     EQU  $18FFE0 ;0 Byte  Interrupt vectors
   229             0000FFE0   JMP_READY         EQU  $00FFE0 ;4 Bytes Jumps to ROM READY routine. Modified whenever alternate co
                    mmand interpreter is loaded.
   230             0000FFE4   VECTOR_COP        EQU  $00FFE4 ;2 Bytes Native COP Interrupt vector
   231             0000FFE6   VECTOR_BRK        EQU  $00FFE6 ;2 Bytes Native BRK Interrupt vector
   232             0000FFE8   VECTOR_ABORT      EQU  $00FFE8 ;2 Bytes Native ABORT Interrupt vector
   233             0000FFEA   VECTOR_NMI        EQU  $00FFEA ;2 Bytes Native NMI Interrupt vector
   234             0000FFEC   VECTOR_RESET      EQU  $00FFEC ;2 Bytes Unused (Native RESET vector)
   235             0000FFEE   VECTOR_IRQ        EQU  $00FFEE ;2 Bytes Native IRQ Vector
   236             0000FFF0   RETURN            EQU  $00FFF0 ;4 Bytes RETURN key handler. Points to BASIC or MONITOR subroutine 
                    to execute when RETURN is pressed.
   237             0000FFF4   VECTOR_ECOP       EQU  $00FFF4 ;2 Bytes Emulation mode interrupt handler
   238             0000FFF6   VECTOR_EBRK       EQU  $00FFF6 ;2 Bytes Emulation mode interrupt handler
   239             0000FFF8   VECTOR_EABORT     EQU  $00FFF8 ;2 Bytes Emulation mode interrupt handler
   240             0000FFFA   VECTOR_ENMI       EQU  $00FFFA ;2 Bytes Emulation mode interrupt handler
   241             0000FFFC   VECTOR_ERESET     EQU  $00FFFC ;2 Bytes Emulation mode interrupt handler
   242             0000FFFE   VECTOR_EIRQ       EQU  $00FFFE ;2 Bytes Emulation mode interrupt handler
   243             00200000   VECTORS_END       EQU  $200000 ;*End of vector space
   244             0000FFFF   BANK0_END         EQU  $00FFFF ;End of Bank 00 and Direct page
   245                        ;
    39                        
    40                        ; bgnpkhdr
    41                        ;***************************************************************************
    42                        ;  FILE_NAME: WDC_CStartup_816.asm
    43                        ;
    44                        ;  DATA_RIGHTS: Western Design Center and R & C Services Proprietary
    45                        ;               Copyright(C) 1980-2003
    46                        ;               All rights reserved. Reproduction in any manner, 
    47                        ;               in whole or in part, is strictly prohibited without
    48                        ;               the prior written approval of R & C Services or 
    49                        ;               Western Design Center.
    50                        ;
    51                        ;               Information contained in this publication regarding
    52                        ;               device applications and the like is intended through
    53                        ;               suggestion only and may be superseded by updates.  
    54                        ;               It is your responsibility to ensure that your application
    55                        ;               meets with your specifications.  No representation or
    56                        ;               warranty is given and no liability is assumed by 
    57                        ;               Western Design Center, Inc. with respect to the accuracy
  Sat Jul 10 2021  1:15                                                                                                Page 20

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

    58                        ;               or use of such information, or infringement of patents
    59                        ;               or other intellectual property rights arising from such
    60                        ;               use or otherwise.  Use of Western Design Center's products
    61                        ;               as critical components in life support systems is not
    62                        ;               authorized except with express written approval by
    63                        ;               Western Design Center, Inc.'s.  No licenses are conveyed,
    64                        ;               implicitly or otherwise, under any intellectual property rights.
    65                        ;
    66                        ;
    67                        ;
    68                        ;  TITLE: WDC_CStartup_816
    69                        ;
    70                        ;  DESCRIPTION: This File describes the WDC SDS General purpose ROM startup code.
    71                        ;
    72                        ;                Program Flow
    73                        ;
    74                        ;                First we make sure we are in native mode.
    75                        ;                Then we set up the stack pointer.
    76                        ;                Then we set the data bank register.
    77                        ;                Then we copy the initialized data.
    78                        ;                Then we clear out the uninitialized data.
    79                        ;                Then we call main.
    80                        ;
    81                        ;  DEFINED FUNCTIONS:
    82                        ;          Undefined_IRQ
    83                        ;                   - Process a Bad Interrupt Vector - send code & Hang!
    84                        ;
    85                        ;
    86                        ;  SPECIAL_CONSIDERATIONS:
    87                        ;
    88                        ;
    89                        ;  SHARED_DATA:
    90                        ;          None
    91                        ;
    92                        ;  GLOBAL_MODULES:
    93                        ;          None
    94                        ;
    95                        ;  LOCAL_MODULES:
    96                        ;          See above in "DEFINED FUNCTIONS"
    97                        ;
    98                        ;  AUTHOR: Jim Goodnow II
    99                        ;
   100                        ;  CREATION DATE: March 11,1997
   101                        ;
   102                        ;  REVISION HISTORY
   103                        ;     Name           Date         Description
   104                        ;     ------------   ----------   ------------------------------------------------
   105                        ;     R. Greenthal   10/07/2003   1.01 Initial
   106                        ;
   107                        ;
   108                        ;
   109                        ; NOTE:
   110                        ;    Change the lines for each version - current version is 1.01
   111                        ;    See - 
   112                        ;         title  "WDC 'C' Startup Program V 1.01 for Large Model W65C816 - WDC_CStartup_816.asm"
  Sat Jul 10 2021  1:15                                                                                                Page 21

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   113                        ;
   114                        ;
   115                        ;***************************************************************************
   116                        ;endpkhdr
   117                        
   118                        
   119                        ;***************************************************************************
   120                        ;                             Include Files
   121                        ;***************************************************************************
   122                        ;None
   123                        
   124                        
   125                        ;***************************************************************************
   126                        ;                              Global Modules
   127                        ;***************************************************************************
   128                        ;None
   129                        
   130                        ;***************************************************************************
   131                        ;                              External Modules
   132                        ;***************************************************************************
   133                        ;None
   134                        
   135                        ;***************************************************************************
   136                        ;                              External Variables
   137                        ;***************************************************************************
   138                        ;None
   139                        
   140                        
   141                        ;***************************************************************************
   142                        ;                               Local Constants
   143                        ;***************************************************************************
   144                        ;
   145                        
   146                        
   147                        ;	.page
   148                        
   149                        ;***************************************************************************
   150                        ;                          RAM Section
   151                        ;***************************************************************************
   152                        ;   
   153                        
   154                        
   155                        
   156                                sttl "WDC_CStartup_816 Code"
   157                        	.page
   158                        
  Sat Jul 10 2021  1:15                                                                                                Page 22

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   159                        ;***************************************************************************
   160                        ;***************************************************************************
   161                        ;                    WDC_CStartup_816 Code Section
   162                        ;***************************************************************************
   163                        ;***************************************************************************
   164                        
   165                        ****************************************************************
   166                        *                                                              *
   167                        *   Define a special section in case most of the               *
   168                        *      code is not in bank 0.                                  *
   169                        *                                                              *
   170                        ****************************************************************
   171                        ;           Large   Model Function Calls use module Function_Name  and xdef ~~Function_Name
   172                        
   173             0000EF00   STACK   EQU   $EF00     ;CHANGE THIS FOR YOUR SYSTEM
   174                        
   175                        STARTUP SECTION OFFSET $7D00
   176                        
   177                        ~~START:
   178                        
   179                        START:
   180 00:7D00: 78           	SEI
   181 00:7D01: 18                   CLC                ;clear carry
   182 00:7D02: FB                   XCE                ;clear emulation-Now in Native 16 bit Mode
   183 00:7D03: C2 38                REP   #$38         ;16 bit registers and Clear Decimal mode
   184                                LONGI ON
   185                                LONGA ON
   186 00:7D05: A9 00 EF             LDA   #STACK       ;get the stack address
   187 00:7D08: 1B                   TCS                ;and set the stack to it
   188                        
   189                        ****************************************************************
   190                        *                                                              *
   191                        *   Set up the data bank register. We assume that the data     *
   192                        *       section is where we want to point at.                  *
   193                        *                                                              *
   194                        ****************************************************************
   195                        
   196 00:7D09: E2 20                SEP   #$20         ;8 bit accum
   197                                LONGA OFF
   198                        
   199 00:7D0B: A9 xx                LDA   #^_BEG_DATA  ;get bank of data
   200 00:7D0D: 48                   PHA
   201 00:7D0E: AB                   PLB                ;set data bank register
   202 00:7D0F: C2 20                REP   #$20         ;back to 16 bit mode
   203                                LONGA ON
   204                        
   205                        ****************************************************************
   206                        *                                                              *
   207                        *    Next, we want to copy the initialized data from           *
   208                        *      ROM to RAM.                                             *
   209                        *                                                              *
   210                        ****************************************************************
   211                        
   212 00:7D11: A9 xx xx             LDA   #_END_DATA-_BEG_DATA ;number of bytes to copy
   213 00:7D14: F0 0A                BEQ   SKIP         ;if none, just skip
  Sat Jul 10 2021  1:15                                                                                                Page 23

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   214 00:7D16: 3A                   DEC   A            ;less one for MVN instruction
   215 00:7D17: A2 xx xx             LDX   #<_ROM_BEG_DATA ;get source into X
   216 00:7D1A: A0 xx xx             LDY   #<_BEG_DATA  ;get dest into Y
   217 00:7D1D: 54 xx xx             MVN   #^_ROM_BEG_DATA,#^_BEG_DATA ;copy bytes
   218                        SKIP:
   219                        
   220                        ****************************************************************
   221                        *                                                              *
   222                        *   Now, clear out the uninitialized data area.                *
   223                        *    We assume that it is in the same bank as DATA.            *
   224                        *                                                              *
   225                        ****************************************************************
   226                        
   227 00:7D20: A2 xx xx             LDX   #_END_UDATA-_BEG_UDATA  ;get number of bytes to clear
   228 00:7D23: F0 11                BEQ   DONE         ;nothing to do
   229 00:7D25: A9 00 00             LDA   #0           ;get a zero for storing
   230 00:7D28: E2 20                SEP   #$20         ;do byte at a time
   231 00:7D2A: A0 xx xx             LDY   #_BEG_UDATA  ;get beginning of zeros
   232                        
   233 00:7D2D: 99 00 00     LOOP    STA   |0,Y         ;clear memory
   234 00:7D30: C8                   INY                ;bump pointer
   235 00:7D31: CA                   DEX                ;decrement count
   236 00:7D32: D0 F9                BNE   LOOP         ;continue till done
   237 00:7D34: C2 20                REP   #$20         ;16 bit memory reg
   238                        DONE:
   239                        
   240                        ****************************************************************
   241                        *                                                              *
   242                        *   Finally, transfer control to the real program.             *
   243                        *                                                              *
   244                        ****************************************************************
   245                        ;           Small   Model Function Calls use module Function_Name  and xdef __Function_Name
   246                        ;           Medium  Model Function Calls use module Function_Name  and xdef ~_Function_Name
   247                        ;           Large   Model Function Calls use module Function_Name  and xdef ~~Function_Name
   248                        ;           Compact Model Function Calls use module Function_Name  and xdef _~Function_Name	
                    	
   249                        		
   250 00:7D36: EA           		NOP
   251 00:7D37: EA           		NOP
   252                        
   253                        		setas
+  253 00:7D38: E2 20                        SEP #$20        ; set A short 
+  253                                        LONGA OFF
   254 00:7D3A: A9 00        		LDA #00
   255 00:7D3C: 8F E0 00 00  		STA >MOUSE_PTR
   256                        		; Setup the Interrupt Controller
   257                        		; For Now all Interrupt are Falling Edge Detection (IRQ)
   258 00:7D40: A9 FF        		LDA #$FF
   259 00:7D42: 8F 48 01 00  		STA >INT_EDGE_REG0
   260 00:7D46: 8F 49 01 00  		STA >INT_EDGE_REG1
   261 00:7D4A: 8F 4A 01 00  		STA >INT_EDGE_REG2
   262 00:7D4E: 8F 4B 01 00  		STA >INT_EDGE_REG3
   263                        		;; Mask all Interrupt @ This Point
   264 00:7D52: 8F 4C 01 00  		STA >INT_MASK_REG0		
   265 00:7D56: 8F 4D 01 00  		STA >INT_MASK_REG1
  Sat Jul 10 2021  1:15                                                                                                Page 24

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   266 00:7D5A: 8F 4E 01 00  		STA >INT_MASK_REG2
   267 00:7D5E: 8F 4F 01 00  		STA >INT_MASK_REG3
   268                        		
   269                        		setas 
+  269 00:7D62: E2 20                        SEP #$20        ; set A short 
+  269                                        LONGA OFF
   270                        		;JSL IINITSUPERIO
   271                        
   272 00:7D64: A9 31        		LDA #'1'
   273 00:7D66: 8F 01 A0 AF  		STA >$AFA001
   274                        	
   275                        
   276                        		
   277                        		setas
+  277 00:7D6A: E2 20                        SEP #$20        ; set A short 
+  277                                        LONGA OFF
   278                        		
   279                        ENABLE_IRQS
   280                        
   281                        
   282 00:7D6C: AF 41 01 00  		LDA >INT_PENDING_REG1  ; Read the Pending Register &
   283 00:7D70: 29 01        		AND #FNX1_INT00_KBD
   284 00:7D72: 8F 41 01 00  		STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   285                        		; Disable the Mask
   286 00:7D76: AF 4D 01 00  		LDA >INT_MASK_REG1
   287 00:7D7A: 29 FE        		AND #$FE ;~FNX1_INT00_KBD
   288 00:7D7C: 8F 4D 01 00  		STA >INT_MASK_REG1
   289                        
   290 00:7D80: AF 40 01 00  		LDA >INT_PENDING_REG0  ; Read the Pending Register &
   291 00:7D84: 29 80        		AND #FNX0_INT07_MOUSE
   292 00:7D86: 8F 40 01 00  		STA >INT_PENDING_REG0  ; Writing it back will clear the Active Bit
   293 00:7D8A: AF 4C 01 00  		LDA >INT_MASK_REG0
   294 00:7D8E: 29 7F        		AND #$7F ;~FNX0_INT07_MOUSE
   295 00:7D90: 8F 4C 01 00  		STA >INT_MASK_REG0
   296                        
   297                        
   298 00:7D94: AF 40 01 00  		LDA >INT_PENDING_REG0  ; Read the Pending Register &
   299 00:7D98: 29 40        		AND #FNX0_INT06_FDC
   300 00:7D9A: 8F 40 01 00  		STA >INT_PENDING_REG0  ; Writing it back will clear the Active Bit
   301 00:7D9E: AF 4C 01 00  		LDA >INT_MASK_REG0
   302 00:7DA2: 29 BF        		AND #$BF ;~FNX0_INT06_FDC
   303 00:7DA4: 8F 4C 01 00  		STA >INT_MASK_REG0
   304                        
   305                        		
   306 00:7DA8: AF 41 01 00  		LDA >INT_PENDING_REG1
   307 00:7DAC: 29 20        		AND #FNX1_INT05_MPU401
   308                        		;STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   309                        		;LDA >INT_MASK_REG1
   310                        		;AND #$DF ;~FNX1_INT05_MPU401
   311                        		;STA >INT_MASK_REG1
   312                        
   313 00:7DAE: AF 41 01 00  		LDA >INT_PENDING_REG1
   314 00:7DB2: 29 08        		AND #FNX1_INT03_COM2
   315 00:7DB4: 8F 41 01 00  		STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   316 00:7DB8: AF 4D 01 00  		LDA >INT_MASK_REG1
  Sat Jul 10 2021  1:15                                                                                                Page 25

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   317 00:7DBC: 29 F7        		AND #$F7 ;~FNX1_INT03_COM2
   318 00:7DBE: 8F 4D 01 00  		STA >INT_MASK_REG1
   319                        
   320                        
   321 00:7DC2: AF 41 01 00  		LDA >INT_PENDING_REG1
   322 00:7DC6: 29 10        		AND #FNX1_INT04_COM1
   323 00:7DC8: 8F 41 01 00  		STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   324 00:7DCC: AF 4D 01 00  		LDA >INT_MASK_REG1
   325 00:7DD0: 29 EF        		AND #$EF ;~FNX1_INT04_COM1
   326 00:7DD2: 8F 4D 01 00  		STA >INT_MASK_REG1
   327                        
   328 00:7DD6: AF 41 01 00  		LDA >INT_PENDING_REG1
   329 00:7DDA: 29 80        		AND #FNX1_INT07_SDCARD
   330 00:7DDC: 8F 41 01 00  		STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   331 00:7DE0: AF 4D 01 00  		LDA >INT_MASK_REG1
   332 00:7DE4: 29 7F        		AND #$7F ;~FNX1_INT07_SDCARD
   333 00:7DE6: 8F 4D 01 00  		STA >INT_MASK_REG1
   334                        
   335 00:7DEA: AF 42 01 00  		LDA >INT_PENDING_REG2
   336 00:7DEE: 29 80        		AND #FNX1_INT07_SDCARD
   337 00:7DF0: 8F 42 01 00  		STA >INT_PENDING_REG2  ; Writing it back will clear the Active Bit
   338 00:7DF4: AF 4E 01 00  		LDA >INT_MASK_REG2
   339 00:7DF8: 29 7F        		AND #$7F ;~FNX1_INT07_SDCARD
   340 00:7DFA: 8F 4E 01 00  		STA >INT_MASK_REG2
   341                        
   342 00:7DFE: AF 41 01 00  		LDA >INT_PENDING_REG1
   343 00:7E02: 29 80        		AND #FNX1_INT07_SDCARD
   344 00:7E04: 8F 41 01 00  		STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
   345 00:7E08: AF 4D 01 00  		LDA >INT_MASK_REG1
   346 00:7E0C: 29 7F        		AND #$7F ;~FNX1_INT07_SDCARD
   347 00:7E0E: 8F 4D 01 00  		STA >INT_MASK_REG1
   348                        
   349 00:7E12: AF 43 01 00  		LDA >INT_PENDING_REG3
   350 00:7E16: 29 04        		AND #FNX3_INT02_IDE
   351 00:7E18: 8F 43 01 00  		STA >INT_PENDING_REG3  ; Writing it back will clear the Active Bit
   352 00:7E1C: AF 4F 01 00  		LDA >INT_MASK_REG3
   353 00:7E20: 29 FB        		AND #$FB ;~FNX2_INT07_SDCARD
   354 00:7E22: 8F 4F 01 00  		STA >INT_MASK_REG3
   355                        
   356                        
   357                        		;LDA >INT_PENDING_REG2
   358                        		;AND #FNX2_INT07_SDCARD
   359                        		;STA >INT_PENDING_REG2  ; Writing it back will clear the Active Bit
   360                        		;LDA >INT_MASK_REG2
   361                        		;AND #$7F ;~FNX2_INT07_SDCARD
   362                        		;STA >INT_MASK_REG2
   363                        
   364 00:7E26: AF 4C 01 00  		LDA >INT_MASK_REG0
   365 00:7E2A: 29 00        		AND #%00000000
   366 00:7E2C: 8F 4C 01 00  		STA >INT_MASK_REG0
   367                        		
   368 00:7E30: AF 4D 01 00  		LDA >INT_MASK_REG1
   369 00:7E34: 29 00        		AND #%00000000
   370 00:7E36: 8F 4D 01 00  		STA >INT_MASK_REG1
   371                        
  Sat Jul 10 2021  1:15                                                                                                Page 26

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   372 00:7E3A: AF 4E 01 00  		LDA >INT_MASK_REG2
   373 00:7E3E: 29 00        		AND #%00000000
   374 00:7E40: 8F 4E 01 00  		STA >INT_MASK_REG2
   375                        
   376 00:7E44: AF 4F 01 00  		LDA >INT_MASK_REG3
   377 00:7E48: 29 00        		AND #%00000000
   378 00:7E4A: 8F 4F 01 00  		STA >INT_MASK_REG3
   379                        		;LDA >INT_PENDING_REG2
   380                        		;AND #FNX2_INT01_OPL2L | FNX2_INT00_OPL2R
   381                        		;STA >INT_PENDING_REG2  ; Writing it back will clear the Active Bit
   382                        		
   383                        		; Enable Mouse
   384                        		;STA >INT_MASK_REG0
   385                        		;LDA #$FB ;~(FNX0_INT02_TMR0)  ;LDA #~(FNX0_INT00_SOF | FNX0_INT00_SOF )
   386                        		;STA >INT_MASK_REG0
   387                        		
   388                        		; Enable Keyboard
   389                        		;LDA #~(FNX1_INT00_KBD | FNX1_INT05_MPU401)
   390                        		;STA >INT_MASK_REG1
   391                        		
   392                        		; Enable OPL2 Interrupts
   393                        		;LDA #~(FNX2_INT01_OPL2L | FNX2_INT00_OPL2R)
   394                        		;STA >INT_MASK_REG2
   395                                        
   396                        		;JSL IINITKEYBOARD
   397                        
   398                        
   399                        		setas
+  399 00:7E4E: E2 20                        SEP #$20        ; set A short 
+  399                                        LONGA OFF
   400 00:7E50: A9 01        		LDA #Mstr_Ctrl_Text_Mode_En      ;Okay, this Enables the Text Mode (Video Display)
   401 00:7E52: 8F 00 00 AF  		STA >MASTER_CTRL_REG_L
   402                        		; Set the Border Color
   403 00:7E56: A9 20        		LDA #$20
   404 00:7E58: 8F 05 00 AF  		STA >BORDER_COLOR_B
   405 00:7E5C: 8F 07 00 AF  		STA >BORDER_COLOR_R
   406                        		;LDA #$DD
   407 00:7E60: A9 20        		LDA #$20
   408 00:7E62: 8F 06 00 AF  		STA >BORDER_COLOR_G
   409 00:7E66: A9 01        		LDA #Border_Ctrl_Enable   ; Enable the Border
   410 00:7E68: 8F 04 00 AF  		STA >BORDER_CTRL_REG
   411                        		; Enable the Text Mode Only
   412 00:7E6C: A9 01        		LDA #Mstr_Ctrl_Text_Mode_En
   413 00:7E6E: 8F 00 00 AF  		STA >MASTER_CTRL_REG_L
   414                        		; enable interrupts
   415                        
   416 00:7E72: A9 F0        		LDA #$F0
   417 00:7E74: 8F 1C 00 AF  		STA >$af001c ;VKY_LINE0_CMP_VALUE_LO
   418 00:7E78: A9 01        		LDA #$01 ; Enable Line Interrupt
   419 00:7E7A: 8F 1B 00 AF  		STA >$af001b ;VKY_LINE_IRQ_CTRL_REG
   420 00:7E7E: AF 40 01 00  		LDA >INT_PENDING_REG0  ; Read the Pending Register &
   421 00:7E82: 29 01        		AND #FNX0_INT00_SOF
   422                        		;AND #FNX0_INT01_SOL
   423 00:7E84: 8F 40 01 00  		STA >INT_PENDING_REG0  ; Writing it back will clear the Active Bit
   424 00:7E88: AF 4C 01 00  		LDA >INT_MASK_REG0
  Sat Jul 10 2021  1:15                                                                                                Page 27

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   425 00:7E8C: 29 FE        		AND #$FE ;~FNX0_INT00_SOF
   426 00:7E8E: 8F 4C 01 00  		STA >INT_MASK_REG0				;
   427                        	
   428                        	
   429                        		
   430                        	
   431                        		
   432                        		setal
+  432 00:7E92: C2 20                        REP #$20        ; set A long 
+  432                                        LONGA ON
   433                        		
   434                        	
   435                        	;CLI
   436                        
   437                        		setas 
+  437 00:7E94: E2 20                        SEP #$20        ; set A short 
+  437                                        LONGA OFF
   438                        		
   439 00:7E96: A9 00        		LDA #$00
   440 00:7E98: 8F 61 01 00  		STA >TIMER0_CHARGE_L
   441 00:7E9C: 8F 62 01 00  		STA >TIMER0_CHARGE_M
   442 00:7EA0: 8F 63 01 00  		STA >TIMER0_CHARGE_H
   443                        		
   444 00:7EA4: A9 00        		LDA #$00
   445 00:7EA6: 8F 65 01 00  		STA >TIMER0_CMP_L
   446                        		
   447 00:7EAA: A9 F0        		LDA #$F0
   448 00:7EAC: 8F 66 01 00  		STA >TIMER0_CMP_M
   449                        		
   450 00:7EB0: A9 0A        		LDA #$0A
   451 00:7EB2: 8F 67 01 00  		STA >TIMER0_CMP_H
   452                        		
   453 00:7EB6: A9 01        		LDA #TMR0_CMP_RECLR
   454 00:7EB8: 8F 64 01 00  		STA >TIMER0_CMP_REG
   455                        		
   456 00:7EBC: A9 01        		LDA #TMR0_EN
   457 00:7EBE: 09 08        		ORA #TMR0_UPDWN
   458 00:7EC0: 09 02        		ORA #TMR0_SCLR
   459 00:7EC2: 8F 60 01 00  		STA >TIMER0_CTRL_REG
   460                        
   461                                ; Clear Any Pending Interrupt
   462                        		;LDA >INT_PENDING_REG0
   463                        		;AND #FNX0_INT02_TMR0 ;
   464                        		;STA >INT_PENDING_REG0  ; Writing it back will clear the Active Bit
   465                        		;LDA >INT_MASK_REG0
   466                        		;AND #$FB ;~FNX0_INT02_TMR0
   467                        		;STA >INT_MASK_REG0		
   468                        		
   469                        		;setas
   470                        		;LDA #'X'
   471                        		;STA >$AFA003
   472                        		
   473 00:7EC6: A9 32        		LDA #'2'
   474 00:7EC8: 8F 02 A0 AF  		STA >$AFA002
   475                        		
  Sat Jul 10 2021  1:15                                                                                                Page 28

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Code"

   476                        		setal
+  476 00:7ECC: C2 20                        REP #$20        ; set A long 
+  476                                        LONGA ON
   477                        		
   478                        		;JSL IINITKEYBOARD
   479                        		
   480                        		XREF  ~~main      ;change MYSTART to yours
   481 00:7ECE: 22 xx xx xx          JSL   ~~main      ;long jump in case not bank 0
   482                        
   483                        	XDEF ~~_exit
   484                        ~~_exit:
   485 00:7ED2: 00 00                BRK
   486                        
   487                        
   488                        
   489                        
   490                                sttl "WDC_CStartup_816 IRQ - Interrupt Handler Code"
   491                        	.page
   492                        
  Sat Jul 10 2021  1:15                                                                                                Page 29

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 IRQ - Interrupt Handler Code"

   493                        ;***************************************************************
   494                        ;                                                              *
   495                        ;   Example of transfering control to the real Interrupt       *
   496                        ;    Handler written in 'C'. Note: save all the registers      *
   497                        ;                                                              *
   498                        ;***************************************************************
   499                        		XDEF	IRQ
   500                        
   501                        IRQ:	
   502                        		
   503                        		setal 	
+  503 00:7ED4: C2 20                        REP #$20        ; set A long 
+  503                                        LONGA ON
   504                        		;Example of needing to read/write to data in another data bank
   505                        
   506 00:7ED6: 8B           		phb		; save Data Bank
   507 00:7ED7: 0B           		phd		; save Direct Page Register
   508 00:7ED8: 48           		pha
   509 00:7ED9: DA           		phx
   510 00:7EDA: 5A           		phy
   511                        
   512                        		setas
+  512 00:7EDB: E2 20                        SEP #$20        ; set A short 
+  512                                        LONGA OFF
   513                        
   514                        		;LDA #'A'
   515                        		;STA >$AFA000
   516                        
   517                        
   518                        
   519                        		setal
+  519 00:7EDD: C2 20                        REP #$20        ; set A long 
+  519                                        LONGA ON
   520                        		XREF	~~IRQHandler
   521 00:7EDF: 22 xx xx xx  		JSL		~~IRQHandler
   522                        
   523                        		;setas
   524                        		;LDA #'B'
   525                        		;STA >$AFA000
   526                        
   527                        		setal
+  527 00:7EE3: C2 20                        REP #$20        ; set A long 
+  527                                        LONGA ON
   528                        		
   529                        
   530                        
   531 00:7EE5: 7A           		ply
   532 00:7EE6: FA           		plx
   533 00:7EE7: 68           		pla
   534 00:7EE8: 2B           		pld		; restore Direct Page Reg
   535 00:7EE9: AB           		plb		; Restore Data Bank
   536                        
   537                        
   538                        		
   539 00:7EEA: 40           		RTI
  Sat Jul 10 2021  1:15                                                                                                Page 30

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 IRQ - Interrupt Handler Code"

   540                        
   541                        
   542                        NMI:
   543 00:7EEB: 40           		RTI
   544                        
   545                        
   546                        BRK:	
   547                        
   548                        		setal 	
+  548 00:7EEC: C2 20                        REP #$20        ; set A long 
+  548                                        LONGA ON
   549                        		;Example of needing to read/write to data in another data bank
   550                        
   551 00:7EEE: 8B           		phb		; save Data Bank
   552 00:7EEF: 0B           		phd		; save Direct Page Register
   553 00:7EF0: 48           		pha
   554 00:7EF1: DA           		phx
   555 00:7EF2: 5A           		phy
   556                        
   557                        		setas
+  557 00:7EF3: E2 20                        SEP #$20        ; set A short 
+  557                                        LONGA OFF
   558                        
   559                        		setal
+  559 00:7EF5: C2 20                        REP #$20        ; set A long 
+  559                                        LONGA ON
   560                        		XREF	~~BRKHandler
   561 00:7EF7: 22 xx xx xx  		jsl		~~BRKHandler
   562                        
   563                        		setal
+  563 00:7EFB: C2 20                        REP #$20        ; set A long 
+  563                                        LONGA ON
   564                        		
   565 00:7EFD: 7A           		ply
   566 00:7EFE: FA           		plx
   567 00:7EFF: 68           		pla
   568 00:7F00: 2B           		pld		; restore Direct Page Reg
   569 00:7F01: AB           		plb		; Restore Data Bank
   570                        
   571 00:7F02: 40           		RTI
   572                        		
   573                        COP:	
   574                        
   575                        		setal 	
+  575 00:7F03: C2 20                        REP #$20        ; set A long 
+  575                                        LONGA ON
   576                        		;Example of needing to read/write to data in another data bank
   577                        
   578 00:7F05: 8B           		phb		; save Data Bank
   579                        
   580                        		;phk
   581                        		;plb
   582                        
   583 00:7F06: 0B           		phd		; save Direct Page Register
   584 00:7F07: 48           		pha
  Sat Jul 10 2021  1:15                                                                                                Page 31

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 IRQ - Interrupt Handler Code"

   585 00:7F08: DA           		phx
   586 00:7F09: 5A           		phy
   587                        
   588                        		setas
+  588 00:7F0A: E2 20                        SEP #$20        ; set A short 
+  588                                        LONGA OFF
   589                        
   590                        		setal
+  590 00:7F0C: C2 20                        REP #$20        ; set A long 
+  590                                        LONGA ON
   591                        		XREF	~~COPHandler
   592 00:7F0E: 22 xx xx xx  		jsl		~~COPHandler
   593                        
   594                        		setal
+  594 00:7F12: C2 20                        REP #$20        ; set A long 
+  594                                        LONGA ON
   595                        		
   596 00:7F14: 7A           		ply
   597 00:7F15: FA           		plx
   598 00:7F16: 68           		pla
   599 00:7F17: 2B           		pld		; restore Direct Page Reg
   600 00:7F18: AB           		plb		; Restore Data Bank
   601                        
   602 00:7F19: 40           		RTI
   603                        ;************************************************
   604                        ; Bad Vectors
   605                        ;************************************************
   606                        
   607                        Undefined_IRQ:
   608 00:7F1A: EA           		nop
   609 00:7F1B: 80 FD        		bra Undefined_IRQ
   610                        
   611                        
   612                        ;WDCMON_START	EQU	$7E00
   613                        ;ROMSPACE EQU WDCMON_START-*  ;gives space left in the ROM BEFORE TABLES;
   614                        ;	IF ROMSPACE<0
   615                        		;EXIT         "Not Enough Memory for WDC_Cstartup_02.ASM - bumping into WDCMON! ! ! ! ! 
                    ! ! ! ! ! ! !"
   616                        	;ENDIF
   617                        
   618                        ;        ENDS
   619                        
   620                        
   621                                XREF  _BEG_DATA
   622                                XREF  _END_DATA
   623                                XREF  _ROM_BEG_DATA
   624                                XREF  _BEG_UDATA
   625                                XREF  _END_UDATA
   626                        
   627                        
   628 00:7F1D:              	ends
   629                        
   630                        
   631                        ;        DATA
   632                        ;        XDEF  ~~heap_start,~~heap_end
  Sat Jul 10 2021  1:15                                                                                                Page 32

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 IRQ - Interrupt Handler Code"

   633                        ;~~heap_start:
   634                        ;        WORD  $6000
   635                        ;~~heap_end:
   636                        ;        WORD  $7CF0
   637                        ;
   638                        ;        ENDS
   639                        
   640                        
   641                                sttl "IINITSUPERIO"
   642                        	.page
   643                        	
  Sat Jul 10 2021  1:15                                                                                                Page 33

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   644                        	xdef ~~k_init_superio	
   645                        ~~k_init_superio:	
   646                        IINITSUPERIO	
   647                        		
   648                        		setal
+  648 00:0000: C2 20                        REP #$20        ; set A long 
+  648                                        LONGA ON
   649                        		
   650 00:0002: 0B           		PHD
   651 00:0003: 08           		PHP
   652 00:0004: 48           		PHA
   653                        		setas			;just make sure we are in 8bit mode
+  653 00:0005: E2 20                        SEP #$20        ; set A short 
+  653                                        LONGA OFF
   654                        
   655 00:0007: A9 01        		LDA #$01		;Default Value - C256 Doesn't use this IO Pin
   656 00:0009: 8F 23 11 AF  		STA >GP10_REG
   657 00:000D: AD 23 11     		LDA GP10_REG
   658 00:0010: A9 01        		LDA #$01		;Default Value - C256 Doesn't use this IO Pin
   659 00:0012: 8F 24 11 AF  		STA >GP11_REG
   660 00:0016: A9 01        		LDA #$01		;Default Value - C256 Doesn't use this IO Pin
   661 00:0018: 8F 25 11 AF  		STA >GP12_REG
   662 00:001C: A9 01        				LDA #$01		;Default Value - C256 Doesnt use this IO Pin
   663 00:001E: 8F 26 11 AF  				STA >GP13_REG
   664 00:0022: A9 05        				LDA #$05		;(C256 - POT A Analog BX) Bit[0] = 1, Bit[2] = 1
   665 00:0024: 8F 27 11 AF  				STA >GP14_REG
   666 00:0028: A9 05        				LDA #$05		;(C256 - POT A Analog BY) Bit[0] = 1, Bit[2] = 1
   667 00:002A: 8F 28 11 AF  				STA >GP15_REG
   668 00:002E: A9 05        				LDA #$05		;(C256 - POT B Analog BX) Bit[0] = 1, Bit[2] = 1
   669 00:0030: 8F 29 11 AF  				STA >GP16_REG
   670 00:0034: A9 05        				LDA #$05		;(C256 - POT B Analog BY) Bit[0] = 1, Bit[2] = 1
   671 00:0036: 8F 2A 11 AF  				STA >GP17_REG
   672 00:003A: A9 00        				LDA #$00		;(C256 - HEADPHONE MUTE) - Output GPIO - Push-Pu
                    ll (1 - Headphone On, 0 - HeadPhone Off)
   673 00:003C: 8F 2B 11 AF  				STA >GP20_REG
   674                        
   675                        		;LDA #$00		;(C256 - FLOPPY - DS1) - TBD Later, Floppy Stuff (JIM DREW)
   676                        				;STA >GP21_REG
   677                        				;LDA #$00		;(C256 - FLOPPY - DMTR1) - TBD Later, Floppy Stu
                    ff (JIM DREW)
   678                        				;STA >GP22_REG
   679                        
   680 00:0040: A9 01        				LDA #$01		;Default Value - C256 Doesnt use this IO Pin
   681 00:0042: 8F 2F 11 AF  				STA >GP24_REG
   682 00:0046: A9 05        				LDA #$05		;(C256 - MIDI IN) Bit[0] = 1, Bit[2] = 1 (Page 1
                    32 Manual)
   683 00:0048: 8F 30 11 AF  				STA >GP25_REG
   684 00:004C: A9 84        				LDA #$84		;(C256 - MIDI OUT) Bit[2] = 1, Bit[7] = 1 (Open 
                    Drain - To be Checked)
   685 00:004E: 8F 31 11 AF  				STA >GP26_REG
   686                        
   687 00:0052: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 1) Setup
                     as GPIO Input for now
   688 00:0054: 8F 33 11 AF  				STA >GP30_REG
   689 00:0058: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 4) Setup
  Sat Jul 10 2021  1:15                                                                                                Page 34

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

                     as GPIO Input for now
   690 00:005A: 8F 34 11 AF  				STA >GP31_REG
   691 00:005E: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 3) Setup
                     as GPIO Input for now
   692 00:0060: 8F 35 11 AF  				STA >GP32_REG
   693 00:0064: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 6) Setup
                     as GPIO Input for now
   694 00:0066: 8F 36 11 AF  				STA >GP33_REG
   695 00:006A: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 5) Setup
                     as GPIO Input for now
   696 00:006C: 8F 37 11 AF  				STA >GP34_REG
   697 00:0070: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 8) Setup
                     as GPIO Input for now
   698 00:0072: 8F 38 11 AF  				STA >GP35_REG
   699 00:0076: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 7) Setup
                     as GPIO Input for now
   700 00:0078: 8F 39 11 AF  				STA >GP36_REG
   701 00:007C: A9 01        				LDA #$01		;Default Value - (C256 - JP1 Fanout Pin 10) Setu
                    p as GPIO Input for now
   702 00:007E: 8F 3A 11 AF  				STA >GP37_REG
   703                        
   704                        				;LDA #$01		;(C256 - FLOPPY - DRVDEN0) - TBD Later, Floppy S
                    tuff (JIM DREW)
   705                        				;STA >GP40_REG
   706                        				;LDA #$01		;(C256 - FLOPPY - DRVDEN1) - TBD Later, Floppy S
                    tuff (JIM DREW)
   707                        				;STA >GP41_REG
   708 00:0082: A9 01        				LDA #$01		;Default Value - C256 Doesnt use this IO Pin
   709 00:0084: 8F 3D 11 AF  				STA >GP42_REG
   710 00:0088: A9 01        			  LDA #$01		;(C256 - INPUT PLL CLK INTERRUPT) Default Value - Will k
                    eep it as an input for now, no real usage for now
   711 00:008A: 8F 3E 11 AF  				STA >GP43_REG
   712 00:008E: A9 05        				LDA #$05		;(C256 - UART2 - RI2) - Input - Set Secondary Fu
                    nction
   713 00:0090: 8F 3F 11 AF  				STA >GP50_REG
   714 00:0094: A9 05        				LDA #$05		;(C256 - UART2 - DCD2) - Input - Set Secondary F
                    unction
   715 00:0096: 8F 40 11 AF  				STA >GP51_REG
   716 00:009A: A9 05        				LDA #$05		;(C256 - UART2 - RXD2) - Input - Set Secondary F
                    unction
   717 00:009C: 8F 41 11 AF  				STA >GP52_REG
   718 00:00A0: A9 04        				LDA #$04		;(C256 - UART2 - TXD2) - Output - Set Secondary 
                    Function
   719 00:00A2: 8F 42 11 AF  				STA >GP53_REG
   720 00:00A6: A9 05        				LDA #$05		;(C256 - UART2 - DSR2) - Input - Set Secondary F
                    unction
   721 00:00A8: 8F 43 11 AF  				STA >GP54_REG
   722 00:00AC: A9 04        				LDA #$04		;(C256 - UART2 - RTS2) - Output - Set Secondary 
                    Function
   723 00:00AE: 8F 44 11 AF  				STA >GP55_REG
   724 00:00B2: A9 05        				LDA #$05		;(C256 - UART2 - CTS2) - Input - Set Secondary F
                    unction
   725 00:00B4: 8F 45 11 AF  				STA >GP56_REG
   726 00:00B8: A9 04        				LDA #$04		;(C256 - UART2 - DTR2) - Output - Set Secondary 
                    Function
  Sat Jul 10 2021  1:15                                                                                                Page 35

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   727 00:00BA: 8F 46 11 AF  				STA >GP57_REG
   728 00:00BE: A9 84        				LDA #$84		;(C256 - LED1) - Open Drain - Output
   729 00:00C0: 8F 47 11 AF  				STA >GP60_REG
   730 00:00C4: A9 84        				LDA #$84		;(C256 - LED2) - Open Drain - Output
   731 00:00C6: 8F 48 11 AF  				STA >GP61_REG
   732 00:00CA: A9 00        				LDA #$00		;GPIO Data Register (GP10..GP17) - Not Used
   733 00:00CC: 8F 4B 11 AF  				STA >GP1_REG
   734 00:00D0: A9 01        				LDA #$01		;GPIO Data Register (GP20..GP27) - Bit[0] - Head
                    phone Mute (Enabling it)
   735 00:00D2: 8F 4C 11 AF  				STA >GP2_REG
   736 00:00D6: A9 00        				LDA #$00		;GPIO Data Register (GP30..GP37) - Since it is i
                    n Output mode, nothing to write here.
   737 00:00D8: 8F 4D 11 AF  				STA >GP3_REG
   738 00:00DC: A9 00        				LDA #$00		;GPIO Data Register (GP40..GP47)  - Not Used
   739 00:00DE: 8F 4E 11 AF  				STA >GP4_REG
   740 00:00E2: A9 00        				LDA #$00		;GPIO Data Register (GP50..GP57)  - Not Used
   741 00:00E4: 8F 4F 11 AF  				STA >GP5_REG
   742 00:00E8: A9 00        				LDA #$00		;GPIO Data Register (GP60..GP61)  - Not Used
   743 00:00EA: 8F 50 11 AF  				STA >GP6_REG
   744                        
   745 00:00EE: A9 01        				LDA #$01		;LED1 Output - Already setup by Vicky Init Phase
                    , for now, I will leave it alone
   746 00:00F0: 8F 5D 11 AF  				STA >LED1_REG
   747 00:00F4: A9 02        				LDA #$02		;LED2 Output - However, I will setup this one, t
                    o make sure the Code works (Full On, when Code was ran)
   748 00:00F6: 8F 5E 11 AF  				STA >LED2_REG
   749                        				setal
+  749 00:00FA: C2 20                        REP #$20        ; set A long 
+  749                                        LONGA ON
   750 00:00FC: 68           		PLA
   751 00:00FD: 28           				PLP
   752 00:00FE: 2B           				PLD
   753 00:00FF: 6B           		RTL
   754                        
   755                        
   756                        
   757                        ;
   758                        ; IINITKEYBOARD
   759                        ; Author: Stefany
   760                        ; Note: We assume that A & X are 16Bits Wide when entering here.
   761                        ; Initialize the Keyboard Controler (8042) in the SuperIO.
   762                        ; Inputs:
   763                        ;   None
   764                        ; Affects:
   765                        ;   Carry (c)
   766                        	xdef ~~k_init_keyboard
   767                        ~~k_init_keyboard:
   768                        IINITKEYBOARD	setal  
+  768 00:0100: C2 20                        REP #$20        ; set A long 
+  768                                        LONGA ON
   769 00:0102: 0B           				PHD
   770 00:0103: 08           				        PHP
   771 00:0104: 48           				        PHA
   772 00:0105: DA           				        PHX
   773                        
  Sat Jul 10 2021  1:15                                                                                                Page 36

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   774                                        setas				;just make sure we are in 8bit mode
+  774 00:0106: E2 20                        SEP #$20        ; set A short 
+  774                                        LONGA OFF
   775                                        setxl 					; Set 8bits
+  775 00:0108: C2 10                        REP #$10        ; set X long 
+  775                                        LONGI ON
   776                        
   777                        				; Setup Foreground LUT First
   778 00:010A: 18                           CLC
   779                        
   780 00:010B: 20 xx xx                     JSR Poll_Inbuf ;
   781                        ;; Test AA
   782 00:010E: A9 AA        				        LDA #$AA			;Send self test command
   783 00:0110: 8F 07 18 AF  				        STA >KBD_CMD_BUF
   784                        								;; Sent Self-Test Code and Waiting for R
                    eturn value, it ought to be 0x55.
   785 00:0114: 20 xx xx                     JSR Poll_Outbuf ;
   786                        
   787 00:0117: AF 03 18 AF  				        LDA >KBD_OUT_BUF		;Check self test result
   788 00:011B: C9 55        				        CMP #$55
   789 00:011D: F0 03        				        BEQ	passAAtest
   790                        
   791 00:011F: 82 5E 00                     BRL initkb_loop_out
   792                        
   793                        passAAtest      ;LDA #'A'
   794                        				;STA >$AFA001
   795                        
   796                        
   797                        				;LDX #<>pass_tst0xAAmsg
   798                                        ;JSL IPRINT      ; print Message
   799                        ;; Test AB
   800 00:0122: A9 AB        				LDA #$AB			;Send test Interface command
   801 00:0124: 8F 07 18 AF  				STA >KBD_CMD_BUF
   802                        
   803 00:0128: 20 xx xx                     JSR Poll_Outbuf ;
   804                        
   805 00:012B: AF 03 18 AF  		        LDA >KBD_OUT_BUF		;Display Interface test results
   806 00:012F: C9 00        		        CMP #$00			;Should be 00
   807 00:0131: F0 03        		        BEQ	passABtest
   808                        
   809 00:0133: 82 4A 00                     BRL initkb_loop_out
   810                        
   811                        passABtest      ;LDX #<>pass_tst0xABmsg
   812                                        ;JSL IPRINT       ; print Message
   813                        				;LDA #'B'
   814                        				;STA >$AFA002
   815                                        ;LDA #$A8        ; Enable Second PS2 Port
   816                                        ;STA KBD_DATA_BUF
   817                                        ;JSR Poll_Outbuf ;
   818                        
   819                        ;; Program the Keyboard & Enable Interrupt with Cmd 0x60
   820 00:0136: A9 60                        LDA #$60            ; Send Command 0x60 so to Enable Interrupt
   821 00:0138: 8F 07 18 AF                  STA >KBD_CMD_BUF
   822 00:013C: 20 xx xx                     JSR Poll_Inbuf ;
   823 00:013F: A9 69                        LDA #%01101001      ; Enable Interrupt
  Sat Jul 10 2021  1:15                                                                                                Page 37

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   824                                        ;LDA #%01001011      ; Enable Interrupt for Mouse and Keyboard
   825 00:0141: 8F 03 18 AF                  STA >KBD_DATA_BUF
   826 00:0145: 20 xx xx                     JSR Poll_Inbuf ;
   827                                        ;LDX #<>pass_cmd0x60msg
   828                                        ;JSL IPRINT       ; print Message
   829                        				;LDA #'6'
   830                        				;STA >$AFA003
   831                        
   832                        ; Reset Keyboard
   833 00:0148: A9 FF                        LDA #$FF      ; Send Keyboard Reset command
   834 00:014A: 8F 03 18 AF                  STA >KBD_DATA_BUF
   835                                        ; Must wait here;
   836 00:014E: A2 FF FF                     LDX #$FFFF
   837 00:0151: CA           DLY_LOOP1       DEX
   838 00:0152: EA                           NOP
   839 00:0153: EA                           NOP
   840 00:0154: EA                           NOP
   841 00:0155: EA                           NOP
   842 00:0156: EA                           NOP
   843 00:0157: EA                           NOP
   844 00:0158: EA                           NOP
   845 00:0159: EA                           NOP
   846 00:015A: E0 00 00                     CPX #$0000
   847 00:015D: D0 F2                        BNE DLY_LOOP1
   848 00:015F: 20 xx xx                     JSR Poll_Outbuf ;
   849                        
   850 00:0162: AF 03 18 AF                  LDA >KBD_OUT_BUF   ; Read Output Buffer
   851                        
   852                        				;LDA #'F'
   853                        				;STA >$AFA004
   854                        
   855                                        ;LDX #<>pass_cmd0xFFmsg
   856                                        ;JSL IPRINT       ; print Message
   857                        DO_CMD_F4_AGAIN
   858 00:0166: 20 xx xx                     JSR Poll_Inbuf ;
   859 00:0169: A9 F4        				        LDA #$F4			; Enable the Keyboard
   860 00:016B: 8F 03 18 AF  				        STA >KBD_DATA_BUF
   861 00:016F: 20 xx xx                     JSR Poll_Outbuf ;
   862                        
   863 00:0172: AF 03 18 AF  				        LDA >KBD_OUT_BUF		; Clear the Output buffer
   864 00:0176: C9 FA                        CMP #$FA
   865 00:0178: D0 EC                        BNE DO_CMD_F4_AGAIN
   866                                        ; Till We Reach this point, the Keyboard is setup Properly
   867 00:017A: 20 xx xx                     JSR INIT_MOUSE
   868                        
   869                        				
   870                                        ;; Unmask the Keyboard interrupt
   871                                        ;; Clear Any Pending Interrupt
   872                                        ;LDA >INT_PENDING_REG0  ; Read the Pending Register &
   873                                        ;AND #FNX0_INT07_MOUSE
   874                                        ;STA >INT_PENDING_REG0  ; Writing it back will clear the Active Bit
   875                        
   876                                        ;LDA >INT_PENDING_REG1  ; Read the Pending Register &
   877                                        ;AND #FNX1_INT00_KBD
   878                                        ;STA >INT_PENDING_REG1  ; Writing it back will clear the Active Bit
  Sat Jul 10 2021  1:15                                                                                                Page 38

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   879                                        ; Disable the Mask
   880                                        ;LDA >INT_MASK_REG1
   881                                        ;AND #~FNX1_INT00_KBD
   882                                        ;STA >INT_MASK_REG1
   883                        
   884                                        ;LDA >INT_MASK_REG0
   885                                        ;AND #~FNX0_INT07_MOUSE
   886                                        ;STA >INT_MASK_REG0
   887                        
   888                        
   889                                        ;LDX #<>Success_kb_init
   890                        				;LDA #'1'
   891                        
   892 00:017D: 38                           SEC
   893 00:017E: B0 00                        BCS InitSuccess
   894                        
   895                        initkb_loop_out ;LDX #<>Failed_kb_init
   896                        				;LDA #'0'
   897                        InitSuccess     ;STA >$AFA005
   898                        				;JSL IPRINT       ; print Message
   899                                        setal 					; Set 16bits
+  899 00:0180: C2 20                        REP #$20        ; set A long 
+  899                                        LONGA ON
   900                                        setxl 					; Set 16bits
+  900 00:0182: C2 10                        REP #$10        ; set X long 
+  900                                        LONGI ON
   901                        
   902 00:0184: FA                           PLX
   903 00:0185: 68                           PLA
   904 00:0186: 28           				        PLP
   905 00:0187: 2B           				        PLD
   906 00:0188: 6B                           RTL
   907                        
   908                        Poll_Inbuf	    setas
+  908 00:0189: E2 20                        SEP #$20        ; set A short 
+  908                                        LONGA OFF
   909 00:018B: AF 07 18 AF                  LDA >STATUS_PORT		; Load Status Byte
   910 00:018F: 29 02        				        AND	#<INPT_BUF_FULL	; Test bit $02 (if 0, Empty)
   911 00:0191: C9 02        				        CMP #<INPT_BUF_FULL
   912 00:0193: F0 F4        				        BEQ Poll_Inbuf
   913 00:0195: 60                           RTS
   914                        
   915                        Poll_Outbuf	    setas
+  915 00:0196: E2 20                        SEP #$20        ; set A short 
+  915                                        LONGA OFF
   916 00:0198: AF 07 18 AF                  LDA >STATUS_PORT
   917 00:019C: 29 01                        AND #OUT_BUF_FULL ; Test bit $01 (if 1, Full)
   918 00:019E: C9 01                        CMP #OUT_BUF_FULL
   919 00:01A0: D0 F4                        BNE Poll_Outbuf
   920 00:01A2: 60                           RTS
   921                        
   922                        INIT_MOUSE      setas
+  922 00:01A3: E2 20                        SEP #$20        ; set A short 
+  922                                        LONGA OFF
   923                        
  Sat Jul 10 2021  1:15                                                                                                Page 39

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   924 00:01A5: A9 00                        LDA #$00          ; Tests second PS2 Channel
   925 00:01A7: 8F E0 00 00                  STA >MOUSE_PTR
   926 00:01AB: A9 00                        LDA #$00          ; Tests second PS2 Channel
   927 00:01AD: 8F 06 07 AF                  STA >MOUSE_PTR_BYTE0
   928 00:01B1: A9 00                        LDA #$00          ; Tests second PS2 Channel
   929 00:01B3: 8F 07 07 AF                  STA >MOUSE_PTR_BYTE1
   930 00:01B7: A9 00                        LDA #$00          ; Tests second PS2 Channel
   931 00:01B9: 8F 08 07 AF                  STA >MOUSE_PTR_BYTE2
   932                        
   933 00:01BD: 20 xx xx                     JSR Poll_Inbuf
   934 00:01C0: A9 A8                        LDA #$A8          ; Enable the second PS2 Channel
   935 00:01C2: 8F 07 18 AF                  STA >KBD_CMD_BUF
   936                        
   937                        ;                LDX #$4000
   938                        ;DLY_MOUSE_LOOP  DEX
   939                                        ;CPX #$0000
   940                                        ;BNE DLY_MOUSE_LOOP
   941                        DO_CMD_A9_AGAIN
   942 00:01C6: 20 xx xx                     JSR Poll_Inbuf
   943 00:01C9: A9 A9                        LDA #$A9          ; Tests second PS2 Channel
   944 00:01CB: 8F 07 18 AF                  STA >KBD_CMD_BUF
   945 00:01CF: 20 xx xx                     JSR Poll_Outbuf ;
   946 00:01D2: AF 03 18 AF  				LDA >KBD_OUT_BUF		; Clear the Output buffer
   947 00:01D6: C9 00                        CMP #$00
   948 00:01D8: D0 EC                        BNE DO_CMD_A9_AGAIN
   949                                        ; IF we pass this point, the Channel is OKAY, Let's move on
   950                        
   951 00:01DA: 20 xx xx                     JSR Poll_Inbuf
   952 00:01DD: A9 20                        LDA #$20
   953 00:01DF: 8F 07 18 AF                  STA >KBD_CMD_BUF
   954 00:01E3: 20 xx xx                     JSR Poll_Outbuf ;
   955                        
   956 00:01E6: AF 03 18 AF                  LDA >KBD_OUT_BUF
   957 00:01EA: 09 02                        ORA #$02
   958 00:01EC: 48                           PHA
   959 00:01ED: 20 xx xx                     JSR Poll_Inbuf
   960 00:01F0: A9 60                        LDA #$60
   961 00:01F2: 8F 07 18 AF                  STA >KBD_CMD_BUF
   962 00:01F6: 20 xx xx                     JSR Poll_Inbuf ;
   963 00:01F9: 68                           PLA
   964 00:01FA: 8F 03 18 AF                  STA >KBD_DATA_BUF
   965                        
   966 00:01FE: A9 F6                        LDA #$F6        ;Tell the mouse to use default settings
   967 00:0200: 20 xx xx                     JSR MOUSE_WRITE
   968 00:0203: 20 xx xx                     JSR MOUSE_READ
   969                        
   970                                        ; Set the Mouse Resolution 1 Clicks for 1mm - For a 640 x 480, it needs to be the 
                    slowest
   971 00:0206: A9 E8                        LDA #$E8
   972 00:0208: 20 xx xx                     JSR MOUSE_WRITE
   973 00:020B: 20 xx xx                     JSR MOUSE_READ
   974 00:020E: A9 02                        LDA #$02 ;  0x00 1 count /mm, 0x012 count /mm,0x02 4 count /mm,0x03	8 count 
                    /mm
   975 00:0210: 20 xx xx                     JSR MOUSE_WRITE
   976 00:0213: 20 xx xx                     JSR MOUSE_READ
  Sat Jul 10 2021  1:15                                                                                                Page 40

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

   977                        
   978                        
   979 00:0216: A9 F3                        LDA #$F3
   980 00:0218: 20 xx xx                     JSR MOUSE_WRITE
   981 00:021B: 20 xx xx                     JSR MOUSE_READ
   982 00:021E: A9 0A                        LDA #10
   983 00:0220: 20 xx xx                     JSR MOUSE_WRITE
   984 00:0223: 20 xx xx                     JSR MOUSE_READ
   985                        
   986                                        ; Set the Refresh Rate to 60
   987                        ;                LDA #$F2
   988                        ;                JSR MOUSE_WRITE
   989                        ;                JSR MOUSE_READ
   990                        ;                LDA #60
   991                        ;                JSR MOUSE_WRITE
   992                        ;                JSR MOUSE_READ
   993                        
   994                        
   995 00:0226: A9 4D        				LDA #'M'
   996 00:0228: 8F 0A A0 AF  				STA >$AFA00A
   997                        
   998                        				setal
+  998 00:022C: C2 20                        REP #$20        ; set A long 
+  998                                        LONGA ON
   999                        
  1000                        				XREF  ~~mouse_driver_init
  1001 00:022E: 22 xx xx xx  				JSL   ~~mouse_driver_init
  1002                        
  1003                        				setas
+ 1003 00:0232: E2 20                        SEP #$20        ; set A short 
+ 1003                                        LONGA OFF
  1004                        
  1005 00:0234: A9 4E        				LDA #'N'
  1006 00:0236: 8F 0C A0 AF  				STA >$AFA00C
  1007                        
  1008 00:023A: A9 F4                        LDA #$F4        ; Enable the Mouse
  1009 00:023C: 20 xx xx                     JSR MOUSE_WRITE
  1010 00:023F: 20 xx xx                     JSR MOUSE_READ
  1011                        
  1012                        
  1013                                        ; Let's Clear all the Variables Necessary to Computer the Absolute Position of the
                     Mouse
  1014 00:0242: A9 00                        LDA #$00
  1015 00:0244: 8F E0 00 00                  STA >MOUSE_PTR
  1016 00:0248: 60                           RTS
  1017                        
  1018                        MOUSE_WRITE     setas
+ 1018 00:0249: E2 20                        SEP #$20        ; set A short 
+ 1018                                        LONGA OFF
  1019 00:024B: 48                           PHA
  1020 00:024C: 20 xx xx                     JSR Poll_Inbuf
  1021 00:024F: A9 D4                        LDA #$D4
  1022 00:0251: 8F 07 18 AF                  STA >KBD_CMD_BUF
  1023 00:0255: 20 xx xx                     JSR Poll_Inbuf
  1024 00:0258: 68                           PLA
  Sat Jul 10 2021  1:15                                                                                                Page 41

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "IINITSUPERIO"

  1025 00:0259: 8F 03 18 AF                  STA >KBD_DATA_BUF
  1026 00:025D: 60                           RTS
  1027                        
  1028                        MOUSE_READ      setas
+ 1028 00:025E: E2 20                        SEP #$20        ; set A short 
+ 1028                                        LONGA OFF
  1029 00:0260: 20 xx xx                     JSR Poll_Outbuf ;
  1030 00:0263: AF 03 18 AF                  LDA >KBD_INPT_BUF
  1031 00:0267: 60                           RTS
  1032                        
  1033                                sttl "WDC_CStartup_816 Shadow Vector Defines"
  1034                        	.page
  1035                        
  Sat Jul 10 2021  1:15                                                                                                Page 42

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Shadow Vector Defines"

  1036                        ;***************************************************************************
  1037                        ;        $7E00 - $7FFF New Expanded Shadow Vector Section Definitions
  1038                        ;***************************************************************************
  1039                        ;***************************************************************************
  1040                        ;***************************************************************************
  1041                        
  1042                        ;	hvectors:	section		; the real reset and interrupt vectors
  1043                        ;
  1044                        ;					;65C816 Vectors
  1045                        ;	org	$18ffe4
  1046                        ;					;Status bit E = 0 (Native mode);
  1047                        ;		dw	Undefined_IRQ	; $FFE4 - COP(816)
  1048                        ;		dw	Undefined_IRQ	; $FFE6 - BRK(816)
  1049                        ;		dw	Undefined_IRQ	; $FFE8 - ABORT(816)
  1050                        ;		dw	Undefined_IRQ	; $FFEA - NMI(816)
  1051                        ;		dw	Undefined_IRQ	; $FFEC - IRQRVD(816)
  1052                        ;		dw	IRQ		; $FFEE - IRQ(816)
  1053                        ;					;Status bit E = 1 (Emulation mode)
  1054                        ;		dw	Undefined_IRQ	; $FFF0 - IRQRVD(816)
  1055                        ;		dw	Undefined_IRQ	; $FFF2 - IRQRVD(816)
  1056                        ;		dw	Undefined_IRQ	; $FFF4 - COP(816Emulation)
  1057                        ;		dw	Undefined_IRQ	; $FFF6 - IRQRVD(816Emulation)
  1058                        ;		dw	Undefined_IRQ	; $FFF8 - ABORT(816Emulation)
  1059                        ;
  1060                        ;					; Common Vectors for all CPUs
  1061                        ;		dw	Undefined_IRQ	; $FFFA -  NMIRQ (ALL)
  1062                        ;		dw	START		; $FFFC -  RESET (ALL)
  1063                        ;		dw	Undefined_IRQ	; $FFFE -  IRQBRK (ALL)
  1064                        ;
  1065                        ;		ends
  1066                        
  1067                        
  1068                        	        
  1069                        
  1070                        
  1071                        
  1072                        ****************************************************************
  1073                        *                                                              *
  1074                        *   This section defines the interrupt and reset vectors.      *
  1075                        *      The reset vectors always start at FFE4 in bank 0.       *
  1076                        *      Since the vectors are only 16 bits, they must point     *
  1077                        *      into bank 0. Replace the "Undefined_IRQ" with any       *
  1078                        *      routines that handle that interrupt.                    *
  1079                        *                                                              *
  1080                        ****************************************************************
  1081                        
  1082                        
  1083                        	vectors:	section		; the real reset and interrupt vectors
  1084                        
  1085                        					;65C816 Vectors
  1086                        		org	$ffe4
  1087                        					;Status bit E = 0 (Native mode)
  1088 00:FFE4: 03 7F        		dw	COP				; $FFE4 - COP(816)
  1089 00:FFE6: EC 7E        		dw	BRK		     	; $FFE6 - BRK(816)
  1090 00:FFE8: 1A 7F        		dw	Undefined_IRQ	; $FFE8 - ABORT(816)
  Sat Jul 10 2021  1:15                                                                                                Page 43

    "FXOS 'C' Startup Program V 1.00 for Large Model W65C816 - fxstartup.asm"
    "WDC_CStartup_816 Shadow Vector Defines"

  1091 00:FFEA: EB 7E        		dw	NMI				; $FFEA - NMI(816)
  1092 00:FFEC: 1A 7F        		dw	Undefined_IRQ	; $FFEC - IRQRVD(816)
  1093 00:FFEE: D4 7E        		dw	IRQ		; $FFEE - IRQ(816)
  1094                        					;Status bit E = 1 (Emulation mode)
  1095 00:FFF0: 1A 7F        		dw	Undefined_IRQ	; $FFF0 - IRQRVD(816)
  1096 00:FFF2: 1A 7F        		dw	Undefined_IRQ	; $FFF2 - IRQRVD(816)
  1097 00:FFF4: 1A 7F        		dw	Undefined_IRQ	; $FFF4 - COP(816Emulation)
  1098 00:FFF6: 1A 7F        		dw	Undefined_IRQ	; $FFF6 - IRQRVD(816Emulation)
  1099 00:FFF8: 1A 7F        		dw	Undefined_IRQ	; $FFF8 - ABORT(816Emulation)
  1100                        
  1101                        					; Common Vectors for all CPUs
  1102 00:FFFA: 1A 7F        		dw	Undefined_IRQ	; $FFFA -  NMIRQ (ALL)
  1103 00:FFFC: 00 7D        		dw	START		; $FFFC -  RESET (ALL)
  1104 00:FFFE: 1A 7F        		dw	Undefined_IRQ	; $FFFE -  IRQBRK (ALL)
  1105                        
  1106 01:0000:              		ends
  1107                        
  1108                        
  1109                        	        end


      Lines assembled: 2113
      Errors: 0
